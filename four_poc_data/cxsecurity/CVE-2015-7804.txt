{
    "text": "vul_name : PHP 5.6.13 Uninitialized pointer in phar_make_dirstream ， vul_cve : CVE-2015-7803 , CVE-2015-7804 ， vul_poc : Description :  ， When parsing a phar file in zip format ( phar_parse_zipfile in ext/phar/zip.c ) with a directory entry with filename / , the filename length is 1 to start with , but then because it is a directory , it is decremented to 0 ( line 399 of ext/phar/zip.c )  , which causes it to get added to the manifest hash as a type LONG not as a type STRING ( line 639 of ext/phar/zip.c ) . ， When making the dirstream from the phar file after loading the zip ( function phar_make_dirstream in ext/phar/dirstream.c )  , the manifest hash is used , but the return is not checked for a STRING type , which is what it expects ( line 201 in ext/phar/dirstream.c ) . In this case , a LONG is returned , and the two variables str_key and keylen are not set. The str_key is further used to set the filename. ， This will cause a crash when compiled with hardening options such as -D_FORTIFY_SOURCE=2 and -fstack-protector-all AND NO optimizations ( -O flags )  , OR when compiled with ASAN. When compiled any other way that I've tried , it doesn't crash , but occasionally leaks data into the filename field outputted. ， This bug was found with afl-fuzz. ， The zip file passed to the script below is available at and has the hexdump of below :  ， 00000000 50 4b 03 04 30 30 30 30 30 30 30 30 30 30 30 30 | PK.000000000000 |  ， 00000010 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 | 0000000000000000 |  *  ， 000000c0 30 30 30 30 30 30 30 30 50 4b 01 02 30 30 30 30 | 00000000PK.0000 |  ， 000000d0 30 30 08 00 30 30 30 30 30 30 30 30 30 30 30 30 | 00.000000000000 |  ， 000000e0 30 30 30 30 01 00 00 00 00 00 30 30 30 30 30 30 | 0000.000000 |  ， 000000f0 30 30 30 30 30 30 2f 50 4b 05 06 00 00 00 00 01 | 000000/PK. |  ， 00000100 00 01 00 30 30 30 30 c8 | .0000. |  ， 00000108 ， To fix :  ， a ) check the return type of zend_hash_get_current_key_ex for more than just non existent ( ie , for LONG as well )  , maybe fail if type is not STRING? ， or b ) don't decrement the entry.filename_len in parse_zip if it would set the length to 0 , that would mean it is stored in the hash as a string , not a long. I'm not too sure of the logic of this , so don't know if that reasoning is right. ， Also , I haven't checked other filetypes for phar , potentially a similar issue is there as well !  ， Cheers ,  ， Hugh ， Test script : ",
    "time": "2015-10-05 / 2015-12-25"
}