{
    "text": "vul_url : ， vul_name : Crypto backdoor in Qnap storage devices (CVE-2009-3200) ， vul_date : 2009.09.23 ， vul_credit_name : Marc Heuse (mh baseline-security de) ， vul_risk : Medium ， vul_local : ， vul_remote : ， vul_cve : CVE-2009-3200, CVE-2009-3278, CVE-2009-3279 ， vul_cwe : CWE-310 ， vul_poc : _ ， Title: Crypto backdoor in Qnap storage devices ， Date: 18 September 2009 ， URL: ， 009-3200.txt ， _ ， Vendor: QNAP Systems ， Products (verified): TS-239 Pro, TS-639 Pro ， Products (unverified): SS-439 Pro, TS-439 Pro, TS-439U-SP/RP, ， TS-509 Pro, SS-839 Pro, TS-809 Pro, TS-809U-RP ， Vulnerability: hard disk encryption bypass due recovery key ， Affected Releases: 3.1.1 0815, 3.1.0 0627, 2.1.7 0613, ， and presumably all other ， Severity: Moderate/High ， CVE: CVE-2009-3200 ， _ ， Overview: ， The premium and new line of QNAP network storage solutions allow ， unlock the hard disk by supplying the encryption passphrase via ， the web GUI. ， However, when the hard disk is encrypted, a secondary key is ， created, added to the keyring, and stored in the flash with minor ， obfuscation. ， Impact: ， The encrypted hard disk can be unlocked and potential sensitive ， contents access by attackers who obtain physical or network ， access to the hard disk and flash. ， Description: ， When a user selects in the web GUI to encrypt a hard drive, he ， has to supply a passphrase of 8-16 length. ， The Qnap solution is to use the underlying Linux standard ， mechanisms of LUKS to create the encrypted partition. ， The user supplied passphrase is crypt(3)'ed with the MD5 salt ， of $1$YCCaQNAP$ and used as the initial key to access the LUKS ， master key for the drive. ， Additionally, the system creates a second key, which is 32 ， characters long and contains all low case characters and the ， numbers 0-9, and adds it to the LUKS keyring: ， /sbin/cryptsetup luksAddKey /dev/md0 /tmp/temp.wLbZNp -key-file=/tmp/temp.rUBxFo ， Before writing the second key to the flash, the key is then ， obfuscated in the following way: ， the first six characters are reversed and written to the end ， of the string. ， The obfuscated string is then written to the flash (/dev/sdx6 ， on current Qnap storage devices) in the ENCK variable. ， Exploit: ， An attacker - or user who has lost his passphrase - just needs ， to do the following: ， 1. Obtain the backdoor key from the flash: ， # strings /dev/sdx6 | grep ENCK ， ENCK=ghijklmnopqrstuvwxyz012345fedcba ， It is possible that several ENCK keys show up. ， 2. The key has then to be deobfuscated. The last 6 characters have ， to be taken, reversed, and put in front of the string: ， ENCK key before: ghijklmnopqrstuvwxyz012345fedcba ， ENCK key after: abcdefghijklmnopqrstuvwxyz012345 ， 3. The key file has to be created: ， # echo -n \"abcdefghijklmnopqrstuvwxyz012345\" > /tmp/key ， 4. The encrypted volume is unlocked and mounted. The device is ， usually /dev/md0 or /dev/sda3. ， # /sbin/cryptsetup luksOpen /dev/md0 md0 -key-file=/tmp/key ， key slot 0 unlocked. ， Command successful. ， # mount /dev/mapper/md0 /share/MD0_DATA ， Full access to the encrypted volume has been obtained. ， Additional Weaknesses: ， The backdoor key is generated by rand() calls. As the rand() ， function produces random numbers unsuitable for cryptographic ， keys. The cryptographic strength of this generated key is ， approx 2^32, hence feasible for breaking. This would make ， access to the flash unnecessary. ， The LUKS partition is created in AES-256 in plain CBC mode. This ， mode is susceptible to watermark attacks."
}