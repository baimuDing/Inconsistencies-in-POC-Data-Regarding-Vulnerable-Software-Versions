{
    "text": "vul_name : Pimcore CMS 1.4.9 <2.1.0 Multiple Vulnerabilities ， vul_cve : CVE-2014-2921 , CVE-2014-2922 ， vul_poc : > Vulnerabilities in Pimcore 1.4.9 to 2.1.0 ( inclusive )  ， > Discovered by Pedro Ribeiro ( pedrib @ gmail.com ) of Agile Information Security ， Disclosure : 14/04/2014 / Last updated : 12/10/2014 ， Vulnerability : Remote code execution in Pimcore CMS via unserialize (  ) PHP object injection ( CVE-2014-2921 )  ， Vulnerability : Arbitrary file deletion in Pimcore CMS via unserialize (  ) PHP object injection ( CVE-2014-2922 )  ， File ( line )  : pimcore/lib/Pimcore/Tool/Newsletter.php ( 221 )  ， Summary :  ， This vulnerability can be exploited by sending a base64 encoded payload as the \"token\" parameter to the newsletter unsubscribe page of the target site. Payload [ 1 ] abuses several Zend classes to achieve remote code execution ( based on Stefan Esser's technique in [ 2 ] and Egidio Romano's exploit code from [ 3 ]  ) . Payload [ 4 ] abuses Zend_Http_Response_Stream to delete a file in /tmp/deleteme and works in all PHP versions. ， Versions affected :  ， 1.4.9 to 1.4.10 ( inclusive ) / 2.0.0 ( possibly )  : Remote code execution ( when server is running PHP <= 5.3.3 ) . ， 1.4.9 to 2.1.0 ( inclusive )  : Arbitrary file deletion ( any PHP version )  , POSSIBLY remote code execution. ， Version 2.2.0 or higher resolves this vulnerability. ， Due to changes introduced in PHP 5.3.4 to reject file names with null bytes , payload [ 3 ] does not work on Pimcore versions between 2.0.1 and 2.1.0 as Pimcore enforces a PHP 5.4 requirement. Version 2.0.0 might be vulnerable if anyone is running it on PHP versions <= 5.3.3. which according to the developers is not possible , but the requirement was only enforced in 2.0.1. ， Note that however the underlying vulnerability for both the remote code execution and the arbitrary file deletion is the same ( unserialize (  ) object injection )  , so it might be possible to execute code if any other Zend PHP POP chains are found in the future. ， Fix for vulnerability :  ， Newsletter.php added to repository on February 25th 2013 ( was released in 1.4.9 on 02/Mar/13 )  :  ， PHP 5.4 requirement introduced on October 31st 2013 ( was released in 2.0.1 on 20/Dec/13 )  :  ， Code snippets :  ， pimcore/lib/Pimcore/Tool/Newsletter.php ( 221 )  :  ， public function getObjectByToken (  $ token ) { ，  $ data = unserialize ( base64_decode (  $ token )  ;  ，  $ object = $ version->getData (  )  ;  ， } ， This function is called in the same file in confirm (  ) and unsubscribeByToken (  )  :  ， public function confirm (  $ token ) { ，  $ object = $ this->getObjectByToken (  $ token )  ;  ， public function unsubscribeByToken (  $ token ) { ，  $ object = $ this->getObjectByToken (  $ token )  ;  ， In the Pimcore Wiki [ 5 ] and sample site [ 6 ]  , users are shown how to use the token parameter and encourage you to take the sample code and modify it. ， The sample code passes the token directly without any validation in confirmAction (  )  :  ， public function confirmAction (  ) { ，  $ this->enableLayout (  )  ;  ，  $ this->view->success = false ;  ，  $ newsletter = new Pimcore_Tool_Newsletter ( \"person\" )  ; / replace \"crm\" with the class name you have used for your class above ( mailing list )  ，  $ this->view->success = true ;  ， } ， And also in unsubscribeAction (  )  :  ， public function unsubscribeAction (  ) { ，  $ this->enableLayout (  )  ;  ，  $ newsletter = new Pimcore_Tool_Newsletter ( \"person\" )  ; / replace \"crm\" with the class name you have used for your class above ( mailing list )  ，  $ unsubscribeMethod = null ;  ，  $ success = false ;  ，  $ unsubscribeMethod = \"email\" ;  ，  $ success = $ newsletter->unsubscribeByEmail (  $ this->getParam ( \"email\" )  ;  ， } ，  $ unsubscribeMethod = \"token\" ;  ，  $ success = $ newsletter->unsubscribeByToken (  $ this->getParam ( \"token\" )  ;  ， } ， Mitigation :  ， Do not pass untrusted input into the unserialize function. Use JSON encoding / decoding instead of unserialize. This was introduced in commit 3cb2683e669 and released in version 2.2.0. ，  [ 1 ] Remote code execution , PHP <= 5.3.3 , original code from [ 3 ]  ( Egidio Romano ) ",
    "time": "2018.01.26"
}