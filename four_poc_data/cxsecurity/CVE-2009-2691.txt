{
    "text": "vul_name : linux 2.6.30.4 /proc/ $ pid/maps visible during initial setuid ELF loading ， vul_cve : CVE-2009-2691 ， vul_poc : - ， From Kees Cook : Steve Beattie and I noticed that the /proc/ $ pid/maps and smaps ， files are readable during ELF loading for processes that a user should not ， normally be able to see ( for example , when launching a setuid process ) . ， mm_for_maps (  ) takes ->mmap_sem after security checks , this looks ， strange and obfuscates the locking rules. Move this lock to its ， single caller , m_start (  ) . ， Signed-off-by : Oleg Nesterov <oleg @ redhat.com> ， fs/proc/task_mmu.c | 1 + ， fs/proc/task_nommu.c | 1 + ， fs/proc/base.c | 8 +- ， 3 files changed , 5 insertions ( + )  , 5 deletions ( - )  ， - WAIT/fs/proc/task_mmu.c ~ 1_MOVE_MMAP_SEM 2009-05-03 17 : 15 : 27.000000000 +0200 ， + WAIT/fs/proc/task_mmu.c 2009-07-10 02 : 00 : 56.000000000 +0200 ， -119 , 6 +119 , 7 static void * m_start ( struct seq_file * m ,  ， mm = mm_for_maps ( priv->task )  ;  ， + down_read ( &mm->mmap_sem )  ;  ， tail_vma = get_gate_vma ( priv->task )  ;  ， priv->tail_vma = tail_vma ;  ， - WAIT/fs/proc/task_nommu.c ~ 1_MOVE_MMAP_SEM 2009-04-09 00 : 39 : 09.000000000 +0200 ， + WAIT/fs/proc/task_nommu.c 2009-07-10 02 : 01 : 25.000000000 +0200 ， -189 , 6 +189 , 7 static void * m_start ( struct seq_file * m ,  ， priv->task = NULL ;  ， } ， + down_read ( &mm->mmap_sem )  ;  ， / * start from the Nth VMA * / ， - WAIT/fs/proc/base.c ~ 1_MOVE_MMAP_SEM 2009-07-09 17 : 56 : 27.000000000 +0200 ， + WAIT/fs/proc/base.c 2009-07-10 02 : 05 : 14.000000000 +0200 ， -235 , 9 +235 , 8 static int check_mem_permission ( struct t ， struct mm_struct * mm_for_maps ( struct task_struct * task )  ， { ， struct mm_struct * mm = get_task_mm ( task )  ;  ， - if (  ! mm )  ， - return NULL ;  ， - if ( mm ! = current->mm ) { ， + ， + if ( mm mm ! = current->mm ) { ，  * task->mm can be changed before security check ,  ，  * in that case we must notice the change after. ， -245 , 10 +244 , 9 struct mm_struct * mm_for_maps ( struct tas ， mm ! = task->mm ) { ， mmput ( mm )  ;  ， - return NULL ;  ， + mm = NULL ;  ， } ， } ， - down_read ( &mm->mmap_sem )  ;  ， }",
    "time": "2009.08.18"
}