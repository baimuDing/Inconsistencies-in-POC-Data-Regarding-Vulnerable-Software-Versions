{
    "text": "ecve : CVE-2016-4793 ， title : CakePHP Framework 3.2.4 - IP Spoofing - PHP webapps Exploit ， verified : Not Verified ， exploit_detail : ============================================= ， - Release date : 12.05.2016 ， - Discovered by : Dawid Golunski ， - Severity : Medium ， I. VULNERABILITY ， CakePHP Framework <= 3.2.4 IP Spoofing Vulnerability ， 3.1.11 ， 2.8.1 ， 2.7.10 ， 2.6.12 ， II. BACKGROUND ， - CakePHP Framework ， \"CakePHP makes building web applications simpler , faster and require less code. ， CakePHP is a modern PHP 5.4+ framework with a flexible Database access layer ， and a powerful scaffolding system that makes building both small and complex ， systems a breeze. \" ， III. INTRODUCTION ， CakePHP Framework contains a vulnerability that allows to spoof the source IP ， address. This can allow to bypass access control lists , or injection of ， malicious data which , if treated as sanitized by an unaware CakePHP-based ， application , can lead to other vulnerabilities such as SQL injection , XSS ,  ， command injection etc. ， IV. DESCRIPTION ， Both branches of CakePHP Framework ( 2.x , 3.x ) contain a clientIp (  ) method that ， allows to obtain the IP address of a client accessing a CakePHP-based ， application. The is slightly different in each branch :  ， CakePHP 2.x :  ， ------ [ Cake/Network/CakeRequest.php ] ------ ， public function clientIp (  $ safe = true ) { ，  $ ipaddr = preg_replace ( '/ ( ? :  , . *  ) /' , '' , env ( 'HTTP_X_FORWARDED_FOR' )  )  ;  ， } else { ，  $ ipaddr = env ( 'HTTP_CLIENT_IP' )  ;  ， } else { ，  $ ipaddr = env ( 'REMOTE_ADDR' )  ;  ，  $ tmpipaddr = env ( 'HTTP_CLIENTADDRESS' )  ;  ，  $ ipaddr = preg_replace ( '/ ( ? :  , . *  ) /' , '' ,  $ tmpipaddr )  ;  ， CakePHP 3.x :  ， ------ [ cakephp/src/Network/Request.php ] ------ ，  * Get the IP the client is using , or says they are using. ，  *  @ return string The client IP. ，  * / ， public function clientIp (  )  ，  $ ipaddr = preg_replace ( '/ ( ? :  , . *  ) /' , '' ,  $ this->env ( 'HTTP_X_FORWARDED_FOR' )  )  ;  ， } else { ，  $ ipaddr = $ this->env ( 'HTTP_CLIENT_IP' )  ;  ， } else { ，  $ ipaddr = $ this->env ( 'REMOTE_ADDR' )  ;  ，  $ tmpipaddr = $ this->env ( 'HTTP_CLIENTADDRESS' )  ;  ，  $ ipaddr = preg_replace ( '/ ( ? :  , . *  ) /' , '' ,  $ tmpipaddr )  ;  ， Both of the methods contain the same vulnerability. Despite the safe flag ，  ( CakePHP 2.x )  , and trustyProxy flag ( CakePHP 3.x ) set to off by default , they ， both use HTTP_CLIENT_IP request header ( if it exists ) instead of the ， REMOTE_ADDR variable set by the web server. ， The HTTP_CLIENT_IP header can easily be spoofed by sending CLIENT-IP header ， in a HTTP request. ， V. PROOF OF CONCEPT EXPLOIT ， A ) Simple PoC ， Download a vulnerable version of CakePHP framework and edit ， src/Template/Pages/home.ctp to include the",
    "time": "2016-05-16"
}