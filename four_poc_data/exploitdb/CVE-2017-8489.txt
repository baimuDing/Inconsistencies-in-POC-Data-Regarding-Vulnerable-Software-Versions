{
    "text": "published_time: 2017-06-21 ， id: 35593 ， eid: 42213 ， cve: CVE-2017-8489 ， title: Microsoft Windows - '0x224000 IOCTL (WmiQueryAllData)' Kernel WMIDataDevice Pool Memory Disclosure - Windows dos Exploit ， author: Google Security Research ， published_time: 2017-06-21 ， verified: Verified ， platform: Windows ， exploit_type: dos ， exploit_url: /download/42213 ， exploit_detail: /*\r ， Source: \r ， We have discovered that the handler of the 0x224000 IOCTL (corresponding to the WmiQueryAllData functionality) implemented by the \\\\.\\WMIDataDevice device in ntoskrnl.exe (as dispatched by the nt!WmipIoControl routine) discloses portions of uninitialized pool memory to user-mode clients.\r ， On our test Windows 7 32-bit workstation, an example layout of the output buffer is as follows:\r ， --- cut ---\r ， 00000000: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 00000010: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 00000020: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 00000030: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 00000040: 00 00 00 00 ff ff ff ff 00 00 00 00 00 00 00 00 ................\r ， 00000050: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 00000060: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 00000070: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 00000080: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 00000090: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 000000a0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 000000b0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 000000c0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 000000d0: 00 00 00 00 00 00 00 00 00 00 ff ff 00 00 00 00 ................\r ， 000000e0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 000000f0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 00000100: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 00000110: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 00000120: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 00000130: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 00000140: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 00000150: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 00000160: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 00000170: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ff ff ................\r ， 00000180: ff ff ff ff ff ff ff ff 00 00 00 00 00 00 00 00 ................\r ， 00000190: ff ff ff ff 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 000001a0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 000001b0: ff ff ff ff 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 000001c0: 00 00 00 00 00 00 00 00 00 00 00 00 ff ff ff ff ................\r ， 000001d0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 000001e0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 000001f0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 00000200: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 00000210: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 00000220: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 00000230: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 00000240: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 00000250: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 00000260: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 00000270: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 00000280: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 00000290: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 000002a0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 000002b0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 000002c0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 000002d0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 000002e0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 000002f0: ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ................\r ， 00000300: 00 00 00 00 00 00 00 00 ff ff ff ff 00 00 00 00 ................\r ， 00000310: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 00000320: 00 00 00 00 00 00 00 00 ff ff ff ff 00 00 00 00 ................\r ， 00000330: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 00000340: 00 00 00 00 ff ff ff ff 00 00 00 00 00 00 00 00 ................\r ， 00000350: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 00000360: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 00000370: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 00000380: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 00000390: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 000003a0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 000003b0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 000003c0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 000003d0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 000003e0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 000003f0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 00000400: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 00000410: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 00000420: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 00000430: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 00000440: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 00000450: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................\r ， 00000460: 00 00 00 00 00 00 00 00 ff ff ff ff ff ff ff ff ................\r ， 00000470: ff ff ff ff ff ff ff ff ?? ?? ?? ?? ?? ?? ?? ?? ................\r ， --- cut ---\r ， Where 00 denote bytes which are properly initialized, while ff indicate uninitialized values copied back to user-mode. As shown above, the uninitialized bytes constitute a significant portion of the overall memory area (72 out of 1136).\r ， The issue can be reproduced by running the attached proof-of-concept program on a system with the Special Pools mechanism enabled for ntoskrnl.exe. Then, it is clearly visible that bytes at the aforementioned offsets are equal to the markers inserted by Special Pools, and would otherwise contain leftover data that was previously stored in that memory region:\r ， --- cut ---\r ， 00000000: 88 01 00 00 10 8d de 8f 00 00 00 00 88 01 00 00 ................\r ， 00000010: 30 8c ea b5 a6 91 d2 01 d1 65 d8 bd c1 d7 d0 11 0........e......\r ， 00000020: a5 01 00 a0 c9 06 29 10 00 00 00 00 81 00 01 00 ......).........\r ， 00000030: 48 00 00 00 01 00 00 00 dc 00 00 00 48 00 00 00 H...........H...\r ， 00000040: 92 00 00 00[ad ad ad ad]00 d8 29 1f 00 00 00 00 ..........).....\r ， 00000050: 00 56 f8 05 00 00 00 00 78 b4 41 3c 00 00 00 00 .V......x.A<....\r ， 00000060: e8 03 6b 03 00 00 00 00 30 9e 33 7f 8d 00 00 00 ..k.....0.3.....\r ， 00000070: 69 5b 00 00 03 44 00 00 00 00 00 00 9b 01 00 00 i[...D..........\r ， 00000080: 30 8c ea b5 a6 91 d2 01 00 00 00 00 50 00 61 00 0...........P.a.\r ， 00000090: 72 00 74 00 6d 00 67 00 72 00 20 00 00 00 00 00 r.t.m.g.r. .....\r ， 000000a0: 38 00 5c 00 44 00 65 00 76 00 69 00 63 00 65 00 8.\\.D.e.v.i.c.e.\r ， 000000b0: 5c 00 48 00 61 00 72 00 64 00 64 00 69 00 73 00 \\.H.a.r.d.d.i.s.\r ， 000000c0: 6b 00 30 00 5c 00 50 00 61 00 72 00 74 00 69 00 k.0.\\.P.a.r.t.i.\r ， 000000d0: 74 00 69 00 6f 00 6e 00 30 00[ad ad]e0 00 00 00 t.i.o.n.0.......\r ， 000000e0: 9c 00 49 00 44 00 45 00 5c 00 44 00 69 00 73 00 ..I.D.E.\\.D.i.s.\r ， 000000f0: 6b 00 56 00 42 00 4f 00 58 00 5f 00 48 00 41 00 k.V.B.O.X._.H.A.\r ， 00000100: 52 00 44 00 44 00 49 00 53 00 4b 00 5f 00 5f 00 R.D.D.I.S.K._._.\r ， 00000110: 5f 00 5f 00 5f 00 5f 00 5f 00 5f 00 5f 00 5f 00 _._._._._._._._.\r ， 00000120: 5f 00 5f 00 5f 00 5f 00 5f 00 5f 00 5f 00 5f 00 _._._._._._._._.\r ， 00000130: 5f 00 5f 00 5f 00 5f 00 5f 00 5f 00 5f 00 5f 00 _._._._._._._._.\r ， 00000140: 5f 00 31 00 2e 00 30 00 5f 00 5f 00 5f 00 5f 00 _.1...0._._._._.\r ， 00000150: 5f 00 5c 00 35 00 26 00 33 00 33 00 64 00 31 00 _.\\.5.&.3.3.d.1.\r ， 00000160: 36 00 33 00 38 00 61 00 26 00 30 00 26 00 30 00 6.3.8.a.&.0.&.0.\r ， 00000170: 2e 00 30 00 2e 00 30 00 5f 00 30 00 00 00[ad ad]..0...0._.0.....\r ， 00000180:[ad ad ad ad ad ad ad ad]72 01 00 00 20 0e d1 8f ........r... ...\r ， 00000190:[ad ad ad ad]78 01 00 00 30 8c ea b5 a6 91 d2 01 ....x...0.......\r ， 000001a0: d1 65 d8 bd c1 d7 d0 11 a5 01 00 a0 c9 06 29 10 .e............).\r ， 000001b0:[ad ad ad ad]81 00 01 00 48 00 00 00 01 00 00 00 ........H.......\r ， 000001c0: d0 00 00 00 48 00 00 00 88 00 00 00[ad ad ad ad]....H...........\r ， 000001d0: 00 00 00 00 00 00 00 00 00 08 02 00 00 00 00 00 ................\r ， 000001e0: 00 00 00 00 00 00 00 00 28 a0 00 00 00 00 00 00 ........(.......\r ， 000001f0: 20 07 d9 9e 8d 00 00 00 00 00 00 00 1e 00 00 00  ...............\r ， 00000200: 00 00 00 00 00 00 00 00 30 8c ea b5 a6 91 d2 01 ........0.......\r ， 00000210: 01 00 00 00 56 00 4f 00 4c 00 4d 00 47 00 52 00 ....V.O.L.M.G.R.\r ， 00000220: 20 00 20 00 00 00 00 00 2e 00 5c 00 44 00 65 00  . .......\\.D.e.\r ， 00000230: 76 00 69 00 63 00 65 00 5c 00 48 00 61 00 72 00 v.i.c.e.\\.H.a.r.\r ， 00000240: 64 00 64 00 69 00 73 00 6b 00 56 00 6f 00 6c 00 d.d.i.s.k.V.o.l.\r ， 00000250: 75 00 6d 00 65 00 31 00 d4 00 00 00 92 00 53 00 u.m.e.1.......S.\r ， 00000260: 54 00 4f 00 52 00 41 00 47 00 45 00 5c 00 56 00 T.O.R.A.G.E.\\.V.\r ， 00000270: 6f 00 6c 00 75 00 6d 00 65 00 5c 00 7b 00 62 00 o.l.u.m.e.\\.{.b.\r ， 00000280: 63 00 30 00 35 00 62 00 34 00 39 00 31 00 2d 00 c.0.5.b.4.9.1.-.\r ， 00000290: 64 00 38 00 34 00 37 00 2d 00 31 00 31 00 65 00 d.8.4.7.-.1.1.e.\r ， 000002a0: 34 00 2d 00 61 00 33 00 30 00 64 00 2d 00 38 00 4.-.a.3.0.d.-.8.\r ， 000002b0: 30 00 36 00 65 00 36 00 66 00 36 00 65 00 36 00 0.6.e.6.f.6.e.6.\r ， 000002c0: 39 00 36 00 33 00 7d 00 23 00 30 00 30 00 30 00 9.6.3.}.#.0.0.0.\r ， 000002d0: 30 00 30 00 30 00 30 00 30 00 30 00 30 00 31 00 0.0.0.0.0.0.0.1.\r ， 000002e0: 30 00 30 00 30 00 30 00 30 00 5f 00 30 00 00 00 0.0.0.0.0._.0...\r ， 000002f0:[ad ad ad ad ad ad ad ad ad ad ad ad ad ad ad ad]................\r ， 00000300: 72 01 00 00 20 ae d3 8f[ad ad ad ad]00 00 00 00 r... ...........\r ， 00000310: 30 8c ea b5 a6 91 d2 01 d1 65 d8 bd c1 d7 d0 11 0........e......\r ， 00000320: a5 01 00 a0 c9 06 29 10[ad ad ad ad]81 00 01 00 ......).........\r ， 00000330: 48 00 00 00 01 00 00 00 d0 00 00 00 48 00 00 00 H...........H...\r ， 00000340: 88 00 00 00[ad ad ad ad]00 d8 29 1f 00 00 00 00 ..........).....\r ， 00000350: 00 4e f6 05 00 00 00 00 98 72 59 3c 00 00 00 00 .N.......rY<....\r ， 00000360: b0 f4 75 03 00 00 00 00 38 80 1c 7f 8d 00 00 00 ..u.....8.......\r ， 00000370: 69 5b 00 00 e5 43 00 00 00 00 00 00 9b 01 00 00 i[...C..........\r ， 00000380: 30 8c ea b5 a6 91 d2 01 02 00 00 00 56 00 4f 00 0...........V.O.\r ， 00000390: 4c 00 4d 00 47 00 52 00 20 00 20 00 00 00 00 00 L.M.G.R. . .....\r ， 000003a0: 2e 00 5c 00 44 00 65 00 76 00 69 00 63 00 65 00 ..\\.D.e.v.i.c.e.\r ， 000003b0: 5c 00 48 00 61 00 72 00 64 00 64 00 69 00 73 00 \\.H.a.r.d.d.i.s.\r ， 000003c0: 6b 00 56 00 6f 00 6c 00 75 00 6d 00 65 00 32 00 k.V.o.l.u.m.e.2.\r ， 000003d0: d4 00 00 00 92 00 53 00 54 00 4f 00 52 00 41 00 ......S.T.O.R.A.\r ， 000003e0: 47 00 45 00 5c 00 56 00 6f 00 6c 00 75 00 6d 00 G.E.\\.V.o.l.u.m.\r ， 000003f0: 65 00 5c 00 7b 00 62 00 63 00 30 00 35 00 62 00 e.\\.{.b.c.0.5.b.\r ， 00000400: 34 00 39 00 31 00 2d 00 64 00 38 00 34 00 37 00 4.9.1.-.d.8.4.7.\r ， 00000410: 2d 00 31 00 31 00 65 00 34 00 2d 00 61 00 33 00 -.1.1.e.4.-.a.3.\r ， 00000420: 30 00 64 00 2d 00 38 00 30 00 36 00 65 00 36 00 0.d.-.8.0.6.e.6.\r ， 00000430: 66 00 36 00 65 00 36 00 39 00 36 00 33 00 7d 00 f.6.e.6.9.6.3.}.\r ， 00000440: 23 00 30 00 30 00 30 00 30 00 30 00 30 00 30 00 #.0.0.0.0.0.0.0.\r ， 00000450: 30 00 30 00 36 00 35 00 30 00 30 00 30 00 30 00 0.0.6.5.0.0.0.0.\r ， 00000460: 30 00 5f 00 30 00 00 00[ad ad ad ad ad ad ad ad]0._.0...........\r ， 00000470:[ad ad ad ad ad ad ad ad]?? ?? ?? ?? ?? ?? ?? ?? ................\r ， --- cut ---\r ， In order to make the"
}