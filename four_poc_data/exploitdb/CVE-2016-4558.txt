{
    "text": "published_time: 2016-05-04 ， id: 33892 ， eid: 39773 ， cve: CVE-2016-4558 ， title: Linux Kernel (Ubuntu 16.04) -  ， author: Google Security Research ， published_time: 2016-05-04 ， verified: Verified ， platform: Linux ， exploit_type: dos ， exploit_url: /download/39773 ， exploit_detail: Source: \r ， Most things in the kernel use 32-bit reference counters, relying on the\r ， fact that the memory constraints of real computers make it impossible to\r ， create enough references to overflow the counters. There are exceptions\r ， to them with relatively little memory usage.\r ， Using BPF_MAP_TYPE_PROG_ARRAY maps, it is possible to create\r ， references to BPF programs that only need sizeof(void*) bytes each\r ， (8 bytes on amd64), permitting an overflow after filling ~32GB of memory\r ， that is subject to RLIMIT_MEMLOCK restrictions.\r ， The requirement for more than 32GB of RAM is relatively high, but not\r ， impossible. The requirement that the allocations need to be below\r ， RLIMIT_MEMLOCK is probably the bigger obstacle for exploitation: On most\r ， Linux systems, every user is only permitted to allocate up to 64KiB of RAM.\r ， However:\r ，  - There are systems where RLIMIT_MEMLOCK is disabled administratively.\r ，  - On systems with containers (e.g. LXC containers), usually every\r ，    container's root user has access to 2^16 different UIDs. If an attacker\r ，    has control over 9 containers and can share file descriptors between\r ，    them or has control over one container with a relatively high number\r ，    of mapped UIDs, he should be able to trigger the overflow.\r ， The attached PoC, when run in a Ubuntu 16.04 VM with 40GB RAM and the\r ， RLIMIT_MEMLOCK limit disabled, needs 25 minutes to execute and causes the\r ， following oops:\r ， [ 1850.676543] BUG: unable to handle kernel paging request at ffffc900069c5010\r ， [ 1850.676550] IP: [<ffffffff81173525>] bpf_prog_put_rcu+0x5/0x30\r ， [ 1850.676556] PGD 9bc094067 PUD 9bc095067 PMD 9b4d2b067 PTE 0\r ， [ 1850.676558] Oops: 0000 [#1] SMP \r ， [ 1850.676561] Modules linked in: nls_utf8 isofs vboxsf(OE) snd_intel8x0 snd_ac97_codec ac97_bus snd_pcm snd_seq_midi snd_seq_midi_event joydev snd_rawmidi snd_seq snd_seq_device snd_timer input_leds snd serio_raw soundcore vboxvideo(OE) 8250_fintek drm i2c_piix4 vboxguest(OE) mac_hid parport_pc ppdev lp parport autofs4 hid_generic usbhid hid psmouse ahci libahci fjes video e1000 pata_acpi\r ， [ 1850.676579] CPU: 0 PID: 1861 Comm: overflow Tainted: G           OE   4.4.0-21-generic #37-Ubuntu\r ， [ 1850.676581] Hardware name: innotek GmbH VirtualBox/VirtualBox, BIOS VirtualBox 12/01/2006\r ， [ 1850.676582] task: ffff8809b2fe4b00 ti: ffff8809b2f3c000 task.ti: ffff8809b2f3c000\r ， [ 1850.676583] RIP: 0010:[<ffffffff81173525>]  [<ffffffff81173525>] bpf_prog_put_rcu+0x5/0x30\r ， [ 1850.676585] RSP: 0018:ffff8809b2f3fdb8  EFLAGS: 00010286\r ， [ 1850.676586] RAX: ffffffff81a24f20 RBX: 0000000000000000 RCX: 0000000000000001\r ， [ 1850.676587] RDX: ffff880230ebc110 RSI: ffff880230ebc100 RDI: ffffc900069c5000\r ， [ 1850.676588] RBP: ffff8809b2f3fdc0 R08: 0000000000000000 R09: 0000000000000000\r ， [ 1850.676589] R10: ffff8809b55468e0 R11: ffff880230ebc110 R12: ffffc90814ce6060\r ， [ 1850.676590] R13: ffffc90814ce6000 R14: ffff8809b5a9d1a0 R15: ffff8809b29cf480\r ， [ 1850.676592] FS:  00007fbe54cf5700(0000) GS:ffff8809e3c00000(0000) knlGS:0000000000000000\r ， [ 1850.676593] CS:  0010 DS: 0000 ES: 0000 CR0: 000000008005003b\r ， [ 1850.676594] CR2: ffffc900069c5010 CR3: 00000009ae9ce000 CR4: 00000000000006f0\r ， [ 1850.676598] Stack:\r ， [ 1850.676599]  ffffffff8117810e ffff8809b2f3fde8 ffffffff811783c6 ffffc90814ce6000\r ， [ 1850.676600]  0000000000000008 ffff8809b55468e0 ffff8809b2f3fdf8 ffffffff811729bd\r ， [ 1850.676602]  ffff8809b2f3fe10 ffffffff811733b9 ffff880230ebc100 ffff8809b2f3fe58\r ， [ 1850.676603] Call Trace:\r ， [ 1850.676607]  [<ffffffff8117810e>] ? prog_fd_array_put_ptr+0xe/0x10\r ， [ 1850.676609]  [<ffffffff811783c6>] bpf_fd_array_map_clear+0x36/0x50\r ， [ 1850.676611]  [<ffffffff811729bd>] bpf_map_put_uref+0x1d/0x20\r ， [ 1850.676612]  [<ffffffff811733b9>] bpf_map_release+0x19/0x30\r ， [ 1850.676616]  [<ffffffff8120e514>] __fput+0xe4/0x220\r ， [ 1850.676617]  [<ffffffff8120e68e>] ____fput+0xe/0x10\r ， [ 1850.676621]  [<ffffffff8109e943>] task_work_run+0x73/0x90\r ， [ 1850.676625]  [<ffffffff81083ba4>] do_exit+0x2e4/0xae0\r ， [ 1850.676626]  [<ffffffff81084423>] do_group_exit+0x43/0xb0\r ， [ 1850.676628]  [<ffffffff810844a4>] SyS_exit_group+0x14/0x20\r ， [ 1850.676632]  [<ffffffff818244f2>] entry_SYSCALL_64_fastpath+0x16/0x71\r ， [ 1850.676633]"
}