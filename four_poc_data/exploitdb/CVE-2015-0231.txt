{
    "text": "ecve : N/A ， title : Kerio Control Unified Threat Management 9.1.0 build 1087/9.1.1 build 1324 - Multiple Vulnerabilities - PHP webapps Exploit ， verified : Not Verified ， exploit_detail : SEC Consult has also released a blog post describing the attack scenarios ， of the vulnerabilities within this advisory in detail and a video which ， shows the remote attack. Exploit code has been developed as well but will ， not be released for now. ， Blog :  ， Video :  ， SEC Consult Vulnerability Lab Security Advisory < 20160922-0 > ， title : Potential backdoor access through multiple vulnerabilities ， product : Kerio Control Unified Threat Management ， vulnerable version : <9.1.3 , verified in version 9.1.0 build 1087 and 9.1.1 ， build 1324 ， fixed version : 9.1.3 ( partially fixed , see vendor statement below )  ， CVE number : - ， impact : critical ， homepage :  ， found : 2016-08-24 ， by : R. Freingruber ( Office Vienna )  ， R. Tavakoli ( Office Vienna )  ， SEC Consult Vulnerability Lab ， An integrated part of SEC Consult ， Bangkok - Berlin - Linz - Montreal - Moscow ， Singapore - Vienna ( HQ ) - Vilnius - Zurich ， Vendor description :  ， \"Protect your network from viruses , malware and malicious activity ， with Kerio Control , the easy-to-administer yet powerful all-in-one ， security solution. ， Kerio Control brings together next-generation firewall capabilities - ， including a network firewall and router , intrusion detection and ， prevention ( IPS )  , gateway anti-virus , VPN , and web contentand ， application filtering. These comprehensive capabilities and unmatched ， deployment flexibility make Kerio Control the ideal choice for small ， and mid-sized businesses.\" ， Source :  ， Business recommendation :  ， By combining the vulnerabilities documented in this advisory an attacker ， can fully compromise a network which uses the Kerio Control appliance for ， protection. ， The attacker can trick a victim to visit a malicious website which then conducts ， the internal attack. The attacked victim must be logged in or weak credentials ， must be configured which can be found with a bruteforce attack. ， The attacker will gain a reverse root shell from the Internet to the internal ， Kerio Control firewall system. Moreover , it's possible that an internal attacker ， uses the described vulnerabilities to escalate his privileges ( low privileged ， account to full root shell ) to steal credentials from other users on the UTM ， appliance. ， Most vulnerabilities ( RCE , CSRF bypasses , XSS , Heap Spraying ) were found ， in just two PHP scripts. Both scripts are not referenced by any other ， PHP script nor by any binary on the system. ， Both scripts contain a different (  !  )  , seemingly deliberate ( ? ) CSRF bypass ， which make the vulnerabilities exploitable from the Internet to obtain a ， reverse root shell. ， SEC Consult recommends not to use Kerio Control until a thorough security ， review has been performed by security professionals and all identified ， issues have been resolved. ， Vulnerability overview/description :  ， 1 ) Unsafe usage of the PHP unserialize function and outdated PHP version leads ， to remote-code-execution ， An authenticated user ( standard user or administrator ) can control data , which ， gets later unserialized. Kerio Control uses PHP 5.2.13 which was released on ， 2010-02-25. This version is more than 6 years old and several bugs were found ， in the meantime within the unserialize function. The following CVE numbers ， are just some examples for vulnerabilities in unserialize which lead to remote ， code execution :  ， - ) CVE-2014-8142 ， - ) CVE-2014-3515 ， - ) CVE-2015-0231 ， - ) CVE-2015-6834 ， - ) CVE-2016-5771 ， - ) CVE-2016-5773 ， PHP 5.2.13 is especially affected by CVE-2014-3515. This vulnerability uses a ， type confusion attack to trigger a use-after-free vulnerability. It can be used ， to read data and get full code execution. In the case of Kerio Control the ， result of unserialize is not reflected back to the attacker. It's therefore not ， possible to read memory from the stack or heap ( e.g. to bypass ASLR ) . ， Nevertheless , SEC Consult developed a fully working and reliable ( blind ) exploit ， system. ， For this exploit a user account is required. However , it's also possible to ， conduct the attack via the Internet because the CSRF ( Cross Site Request ， Forgery ) check can be bypassed ( see below ) . ， An attacker can use this vulnerability to break into a company network via the ， Internet by tricking a logged in user to visit a malicious website. Even if the ， user is currently not logged in the attacker can start a bruteforce attack to ， obtain valid credentials to conduct the attack. ， 2 ) PHP script allows heap spraying ， One of the PHP scripts allows the allocation of memory inside the main binary ，  ( winroute ) of Kerio Control. Winroute contains the code of most services ，  ( e.g. the webserver , PHP , network related functionality , ... ) . ， The memory will not be freed after finishing the request and can therefore be ， used to spray payloads to the whole memory space. ， This vulnerability was used in the overall exploit to defeat ASLR. ， Please bear in mind that it's very likely that an attacker can write a working ， exploit without heap spraying. Fixing this vulnerability would therefore not ， prevent the exploitation of the remote code execution vulnerability. ， For example , the information disclosure vulnerability from this advisory can ， be used to bypass ASLR as well. This would eliminate the need of heap spraying. ， 3 ) CSRF Protection Bypass ， The PHP scripts contain code to protect against CSRF ( Cross Site Request ， Forgery ) attacks. Because of the wrong usage of PHP binary ， operations and comparisons it's possible to bypass this check. That means ， that an attacker can trigger requests from other websites which will be handled ， by Kerio Control. This vulnerability allows to exploit the remote code ， execution vulnerability from the Internet to break into a network. ， 4 ) Webserver running with root privileges ， The main binary ( which contains the webserver and PHP ) runs with root ， privileges. ， Kerio told SEC Consult that this vulnerability will not be fixed. SEC ， Consult strongly recommended otherwise. ， 5 ) Reflected Cross Site Scripting ( XSS )  ， Kerio Control does not properly encode parameters which are reflected on the ， website. This leads to cross site scripting vulnerabilities. ， An attacker can abuse these vulnerabilities to modify the website or do actions ， in the context of the attacked user. ， 6 ) Missing memory corruption protections ， The main binary ( winroute ) is not compiled as position-independent executable ，  ( PIE ) . This allowed the use of ROP ( return-oriented-programming ) code to ， bypass the not executable heap. Moreover , the stack is per default marked as ， executable , but the exact location of the stack is randomized by ASLR. ， 7 ) Information Disclosure leads to ASLR bypass ， One of the PHP scripts leaks pointers to the stack and heap. ， This can be abused by attackers to bypass ASLR. ， Because stacks are marked as executable an attacker can therefore easily bypass ， ASLR and DEP/NX. ， 8 ) Remote Code Execution as administrator ， Nearly a year ago on 2015-10-12 Raschin Tavakoli reported a remote code ， execution vulnerability in the administrative web interface in the upgrade ， functionality. This vulnerability is still unfixed , only the associated XSS ， vulnerability was fixed. However , an attacker can still exploit it from the ， Internet , e.g. by abusing the XSS vulnerability described in this advisory ，  ( where the CSRF check can be bypassed ) . ， With this vulnerability an attacker can gain a reverse root shell on ， Kerio Control again if a logged in administrator visits a malicious website ， on the Internet. ， More information can also be found in the old advisory :  ， 9 ) Login not protected against brute-force attacks ， There are no bruteforce protections in place for the login. ， If an unauthenticated victim visits an attacker's website , the attacker can ， start a bruteforce attack to obtain valid credentials to execute the ， remote code execution exploit. Via image-loading the attacker can detect if ， the current credentials are valid ( without violating SOP ) . ， Proof of concept :  ， 1 ) Unsafe usage of the PHP unserialize function and outdated PHP version leads ， to remote-code-execution ， The following request can be used to set the unserialize data. In this example ， a faked string is used which points to 0xffffffff ( kernel memory ) . Unserializing ， it will therefore crash the remote webserver ( the winroute process ) . ， POST /set.php HTTP/1.1 ， Host :  $ IP : 4081 ， Accept : ",
    "time": "2016-09-22"
}