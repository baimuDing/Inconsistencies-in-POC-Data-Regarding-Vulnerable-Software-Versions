{
    "text": "date_time:Nov 2, 2016 ， title:MySQL / MariaDB / PerconaDB Root Privilege Escalation  ， detail:MySQL-based databases including MySQL, MariaDB and PerconaDB are affected by a privilege escalation vulnerability which can let attackers who have gained access to mysql system user to further escalate their privileges to root user allowing them to fully compromise the system. The vulnerability stems from unsafe file handling of error logs and other files.  ， cve:advisories | CVE-2016-6664  ， date_time:Nov 2, 2016  ， desc:=  ， - Release date: 01.11.2016  ， - Discovered by: Dawid Golunski  ， - Severity: High/Critical  ， - CVE-2016-6664 / OCVE-2016-5617  ， - http:/legalhackers.com  ，  ， I. VULNERABILITY  ，  ， MySQL / MariaDB / PerconaDB - Root Privilege Escalation  ， MySQL  ， <= 5.5.51  ， <= 5.6.32  ， <= 5.7.14  ， MariaDB  ， All current  ， Percona Server  ， < 5.5.51-38.2  ， < 5.6.32-78-1  ， < 5.7.14-8  ， Percona XtraDB Cluster  ， < 5.6.32-25.17  ， < 5.7.14-26.17  ， < 5.5.41-37.0  ， II. BACKGROUND  ，  ， MySQL:  ， \"MySQL is the world's most popular open source database.  ， Whether you are a fast growing web property, technology ISV or large  ， enterprise, MySQL can cost-effectively help you deliver high performance,  ， scalable database applications.\"  ， \"Many of the world's largest and fastest-growing organizations including  ， Facebook, Google, Adobe, Alcatel Lucent and Zappos rely on MySQL to save time  ， and money powering their high-volume Web sites, business-critical systems and  ， packaged software.\"  ， http:/www.mysql.com/products/  ， http:/www.mysql.com/why-mysql/  ，  ， MariaDB:  ， \"MariaDB is one of the most popular database servers in the world.  ， ItAAC/AC/aA!AC/aAC/s made by the original developers of MySQL and guaranteed to stay open source.  ， Notable users include Wikipedia, WordPress.com and Google.  ， MariaDB turns data into structured information in a wide array of applications,  ， ranging from banking to websites. It is an enhanced, drop-in replacement for MySQL.  ， MariaDB is used because it is fast, scalable and robust, with a rich ecosystem of  ， storage engines, plugins and many other tools make it very versatile for a wide  ， variety of use cases.\"  ， https:/mariadb.org/about/  ，  ， PerconaDB:  ， \"Percona Server for MySQL is a free, fully compatible, enhanced, open source  ， drop-in replacement for MySQL that provides superior performance, scalability  ， and instrumentation.  ， With over 3,000,000 downloads, Percona ServerAAC/AC/aA!AC/aAC/s self-tuning algorithms and support  ，  ， https:/www.percona.com/software/mysql-database/percona-server  ， III. INTRODUCTION  ，  ， MySQL-based databases including MySQL, MariaDB and PerconaDB are affected  ， by a privilege escalation vulnerability which can let attackers who have  ， gained access to mysql system user to further escalate their privileges  ， to root user allowing them to fully compromise the system.  ， The vulnerability stems from unsafe file handling of error logs and  ， other files.  ， IV. DESCRIPTION  ，  ， The error.log file on most default installations of MySQL/PerconaDB/MariaDB  ， databases is stored either in /var/log/mysql or /var/lib/mysql directory.  ， The permissions on the file and directory look as follows:  ， root@trusty:/var/lib/mysql# ls -la /var/log/mysql  ， total 468  ， drwxr-s- 2 mysql adm 4096 Sep 11 06:25 .  ， drwxrwxr-x 36 root syslog 4096 Sep 11 06:25 .  ， -rw-r- 1 mysql adm 0 Sep 11 06:25 error.log  ， root@trusty:/var/lib/mysql# ls -lad /var/log/mysql  ， drwxr-s- 2 mysql adm 4096 Sep 11 06:25 /var/log/mysql  ， mysqld_safe wrapper that is normally used for starting MySQL daemon and  ， creating/reopening the error.log performs certain unsafe file operations that  ， may allow attackers to gain root privileges.  ， The wrapper script contains a 'while' loop shown below which monitors the mysqld  ， process and performs a restart in case of the process failure.  ， The restart involves re-creation of the error.log file if syslog logging has  ， not been configured instead of error log files (file-based logging is the  ， default setting on most installations).  ， -[ mysqld_safe ]-  ， [.]  ，  ， do  ， rm -f \"$pid_file\" # Some extra safety  ， start_time=`date +%M%S`  ， eval_log_error \"$cmd\"  ，  ， touch \"$err_log\" # hypothetical: log was renamed but not  ， chown $user \"$err_log\" # flushed yet. we'd recreate it with  ， chmod \"$fmode\" \"$err_log\" # wrong owner next time we log, so set  ， fi # it up correctly while we can!  ， [.]  ，  ， As can be seen, the error.log file is created (touch) and chowned to the user  ， running the mysqld daemon (typically 'mysql').  ， The operation is vulnerable to a symlink attack.  ， Attackers who obtained access to mysql account, through CVE-2016-6663  ， vulnerability described at:  ， http:/legalhackers.com/advisories/MySQL-Maria-Percona-RootPrivEsc-CVE-2016-6664-5617-Exploit.html  ， would gain access to /var/log or /var/lib/mysql directories (owned by mysql user)  ， and could therefore easily remove the error.log file and replace it  ， with a symlink to an arbitrary system file and escalate privileges.  ， The privilege escalation could be triggered instantly (without the need to wait  ，  ， killing the mysqld child process (launched by the mysqld_safe wrapper).  ， When the mysqld process gets terminated, the wrapper will then re-itertate the  ， loop shown above and immediately create a mysql-owned file in the location  ， specified by the attacker in the symlink thus allowing attackers to quickly  ， escalate their privileges.  ， V. PROOF OF CONCEPT EXPLOIT  ，  ， -[ mysql-chowned.sh ]-"
}