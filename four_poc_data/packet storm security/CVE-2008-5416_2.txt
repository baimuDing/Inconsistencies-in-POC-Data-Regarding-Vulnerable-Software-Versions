{
    "text": "title : Microsoft SQL Server sp_replwritetovarbin Memory Corruption  ， detail : A heap-based buffer overflow can occur when calling the undocumented \"sp_replwritetovarbin\" extended stored procedure. This vulnerability affects all versions of Microsoft SQL Server 2000 and 2005 , Windows Internal Database , and Microsoft Desktop Engine ( MSDE ) without the updates supplied in MS09-004. This exploit smashes several pointers , as shown below. 1. pointer to a 32-bit value that is set to 0 2. pointer to a 32-bit value that is set to a length influenced by the buffer length. 3. pointer to a 32-bit value that is used as a vtable pointer. In MSSQL 2000 , this value is referenced with a displacement of 0x38. For MSSQL 2005 , the displacement is 0x10. The address of our buffer is conveniently stored in ecx when this instruction is executed. 4. On MSSQL 2005 , an additional vtable ptr is smashed , which is referenced with a displacement of 4. This pointer is not used by this exploit. There are two different methods used by this exploit , which have been named \"writeNcall\" and \"sprayNbrute\". The first , \"writeNcall\" , was published by k'sOSe on Dec 17 2008. It uses pointers 2 and 3 , as well as a writeable address. This method is quite reliable. However , it relies on the the operation on pointer 2. Newer versions of SQL server ( >= 2000 SP3 at least ) use a length value that is 8-byte aligned. This imposes a restriction that the code address that leads to the payload ( jmp ecx in this case ) must match the regex '. [ 08 ] . [ 08 ] . [ 08 ] . [ 08 ] '. Unfortunately , no such addresses were found in memory. For this reason , the second method , \"sprayNbrute\" is used. First a heap-spray is used to prime memory with lots of copies of the address of our code that leads to the payload ( jmp ecx ) . Next , brute force is used to try to guess a value for pointer 3 that points to the sprayed data. A new method of spraying the heap inside MSSQL is presented. Sadly , it only allows the creation of a bunch of 8000 byte buffers.  ， cve : advisories | CVE-2008-5416  ，  ， desc :  #   ，  #  $ Id : ms09_004_sp_replwritetovarbin.rb 8068 2010-01-05 00 : 02 : 15Z jduck $   ，   ，  # This file is part of the Metasploit Framework and may be subject to  ，  # redistribution and commercial restrictions. Please see the Metasploit  ，  # Framework web site for more information on licensing and terms of use.  ，  # http : /metasploit.com/framework/  ，  ， require 'msf/core'",
    "time": "Jan 5, 2010"
}